{"id":"main-6r0","title":"Define Crumb entity struct and state constants in pkg/types","description":"## Required Reading\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (R1: Crumb struct, R2: State machine)\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (R8: UUID v7)\n- docs/ARCHITECTURE.md § Lifecycle\n- pkg/types/table.go (created in task 1) — for error types used in state transitions\n\n## Files to Create/Modify\n- pkg/types/crumb.go (create) — Crumb struct, state constants, state transition validation\n\n## Requirements\n- Define Crumb struct with fields: CrumbID (string), Name (string), State (string), CreatedAt (time.Time), UpdatedAt (time.Time) per prd003 R1\n- Define state constants: StateDraft, StatePending, StateReady, StateTaken, StatePebble, StateDust per prd003 R2\n- Define valid state transitions map per prd003 R2: draft→pending, pending→ready, ready→taken, taken→pebble, taken→dust, and any→dust\n- Implement ValidateTransition(from, to string) error method that returns ErrInvalidTransition for invalid transitions and ErrInvalidState for unknown states\n- Properties field omitted for now (release 02.0 scope)\n\n## Design Decisions\n- States as string constants, not iota, because they appear in JSONL and JSON output\n- Transition validation as a standalone function (not a Crumb method) so the backend can call it during Set\n- Keep Crumb struct minimal per prd003 R1 — only the fields needed for release 01.0\n\n## Acceptance Criteria\n- [ ] Crumb struct defined with CrumbID, Name, State, CreatedAt, UpdatedAt\n- [ ] All 6 state constants defined\n- [ ] Valid transitions map covers draft→pending, pending→ready, ready→taken, taken→pebble, taken→dust, any→dust\n- [ ] ValidateTransition returns nil for valid transitions\n- [ ] ValidateTransition returns ErrInvalidTransition for invalid transitions (e.g., draft→pebble)\n- [ ] ValidateTransition returns ErrInvalidState for unknown state strings\n- [ ] File compiles: go build ./pkg/types/","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T16:35:01.191523-05:00","created_by":"petardjukic","updated_at":"2026-02-11T16:39:17.338261-05:00","closed_at":"2026-02-11T16:39:17.338261-05:00","close_reason":"Closed","dependencies":[{"issue_id":"main-6r0","depends_on_id":"main-ak0","type":"blocks","created_at":"2026-02-11T16:35:01.393996-05:00","created_by":"petardjukic"}]}
{"id":"main-ak0","title":"Define Cupboard and Table interfaces and lifecycle errors in pkg/types","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (R2: Cupboard Interface, R3: Table Interface, R5-R7: Detach, Errors)\n- docs/ARCHITECTURE.md § Main Interfaces\n- pkg/types/config.go (created in task 0)\n\n## Files to Create/Modify\n- pkg/types/cupboard.go (create) — Cupboard interface, lifecycle errors, standard table name constants\n- pkg/types/table.go (create) — Table interface, table operation errors, entity method errors\n\n## Requirements\n### cupboard.go\n- Define Cupboard interface with GetTable(name string) (Table, error), Attach(config Config) error, Detach() error per prd001 R2.2\n- Define standard table name constants: crumbs, trails, properties, metadata, links, stashes per prd001 R2.5\n- Define cupboard lifecycle errors per prd001 R7.1: ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound\n\n### table.go\n- Define Table interface with Get(id string) (any, error), Set(id string, data any) (string, error), Delete(id string) error, Fetch(filter map[string]any) ([]any, error) per prd001 R3.1\n- Define table operation errors per prd001 R7.2: ErrNotFound, ErrInvalidID, ErrInvalidData\n- Define entity method errors per prd001 R7.3: ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter\n\n## Design Decisions\n- Interfaces in pkg/types/; implementations will go in internal/sqlite/ later\n- Table returns (any, error) from Get — callers use type assertions per prd001 R3.6\n- Standard table names as string constants, not an enum\n\n## Acceptance Criteria\n- [ ] Cupboard interface defined with GetTable, Attach, Detach\n- [ ] Table interface defined with Get, Set, Delete, Fetch\n- [ ] All standard table name constants defined (6 tables)\n- [ ] All cupboard lifecycle errors defined as sentinels\n- [ ] All table operation errors defined as sentinels\n- [ ] All entity method errors defined as sentinels\n- [ ] Files compile: go build ./pkg/types/","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T16:35:01.057314-05:00","created_by":"petardjukic","updated_at":"2026-02-11T16:38:04.696927-05:00","closed_at":"2026-02-11T16:38:04.696927-05:00","close_reason":"Closed","dependencies":[{"issue_id":"main-ak0","depends_on_id":"main-sre","type":"blocks","created_at":"2026-02-11T16:35:01.293232-05:00","created_by":"petardjukic"}]}
{"id":"main-sre","title":"Define Config struct and validation errors in pkg/types","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (R1: Configuration, R7: Standard Error Types)\n- docs/ARCHITECTURE.md § System Overview, § Main Interfaces\n- docs/specs/product-requirements/prd010-configuration-directories.yaml (R1, R2 for directory defaults)\n\n## Files to Create/Modify\n- pkg/types/config.go (create) — Config struct, validation method, config errors\n\n## Requirements\n- Define Config struct with Backend (string) and DataDir (string) fields per prd001 R1.1\n- Implement Config.Validate() method that returns errors per prd001 R1.2, R1.3\n- Define config validation errors per prd001 R1.4: ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid\n- Config struct must be serializable to JSON/YAML\n\n## Design Decisions\n- Place in pkg/types/ as shared public types (go-style rule: pkg/ holds shared public API)\n- Use sentinel errors compatible with errors.Is\n- Keep Backend values as string constants (only \"sqlite\" for now)\n\n## Acceptance Criteria\n- [ ] Config struct defined with Backend and DataDir fields\n- [ ] Config.Validate() returns ErrBackendEmpty when Backend is empty\n- [ ] Config.Validate() returns ErrBackendUnknown when Backend is not \"sqlite\"\n- [ ] Config.Validate() returns error when DataDir is empty and Backend is \"sqlite\"\n- [ ] All error variables defined as sentinel errors\n- [ ] File compiles: go build ./pkg/types/","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T16:35:00.922847-05:00","created_by":"petardjukic","updated_at":"2026-02-11T16:36:53.242819-05:00","closed_at":"2026-02-11T16:36:53.242819-05:00","close_reason":"Closed"}
