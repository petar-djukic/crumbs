{"id":"generation-2026-02-11-21-30-20-14m","title":"Define Cupboard and Table interfaces, Config struct, and error sentinels in pkg/types","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (full PRD — Config, Cupboard, Table, errors, UUID v7)\n- docs/ARCHITECTURE.md § System Overview (ORM-style pattern, three-tier architecture)\n- docs/ARCHITECTURE.md § Main Interfaces (Cupboard and Table contracts)\n- pkg/crumbs/version.go (existing package, note: types go in pkg/types not pkg/crumbs)\n\n## Files to Create/Modify\n- pkg/types/config.go (create) — Config struct with Backend, DataDir fields; config validation errors (ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid); Validate() method\n- pkg/types/cupboard.go (create) — Cupboard interface with GetTable, Attach, Detach; standard table name constants (crumbs, trails, properties, metadata, links, stashes); cupboard lifecycle errors (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound)\n- pkg/types/table.go (create) — Table interface with Get(id string) (any, error), Set(id string, data any) (string, error), Delete(id string) error, Fetch(filter map[string]any) ([]any, error); table operation errors (ErrNotFound, ErrInvalidID, ErrInvalidData); entity method errors (ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter)\n\n## Requirements\n- Define Config struct per prd001 R1 (Backend string, DataDir string)\n- Implement Config.Validate() per prd001 R1.2, R1.3 (fail on empty/unknown Backend, empty DataDir for sqlite)\n- Define Cupboard interface per prd001 R2 (GetTable, Attach, Detach)\n- Define Table interface per prd001 R3 (Get, Set, Delete, Fetch with exact signatures from PRD)\n- Define all standard table name constants per prd001 R2.5\n- Define all sentinel errors per prd001 R1.4, R7.1, R7.2, R7.3\n- Package doc comment referencing prd001-cupboard-core\n\n## Design Decisions\n- pkg/types is the shared public API: types and interfaces only, no implementation\n- All errors use errors.New for Go 1.13+ errors.Is compatibility\n- Config must be JSON/YAML serializable per PRD constraints\n- Table name constants as exported string constants\n- Follow go-style rule: interfaces are small (Cupboard has 3 methods, Table has 4 methods)\n\n## Acceptance Criteria\n- [ ] Config struct has Backend and DataDir fields\n- [ ] Config.Validate() returns correct errors for empty backend, unknown backend, empty DataDir\n- [ ] Cupboard interface has GetTable, Attach, Detach with exact PRD signatures\n- [ ] Table interface has Get, Set (returns string, error), Delete, Fetch with exact PRD signatures\n- [ ] All 6 standard table name constants defined\n- [ ] All sentinel errors from prd001 R1.4, R7.1, R7.2, R7.3 defined\n- [ ] go build ./pkg/types compiles without errors\n- [ ] Package doc comments reference prd001-cupboard-core","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T21:33:22.07373-05:00","created_by":"petardjukic","updated_at":"2026-02-11T21:33:22.07373-05:00"}
{"id":"generation-2026-02-11-21-30-20-3oj","title":"Define shared types and interfaces in pkg/types (prd001-cupboard-core R1-R3, R7-R8)","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Config, Cupboard, Table interfaces, error types, UUID v7)\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (Crumb struct fields, state values)\n- docs/specs/product-requirements/prd006-trails-interface.yaml (Trail struct fields, state values)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (Property, Category struct fields)\n- docs/specs/product-requirements/prd005-metadata-interface.yaml (Metadata struct fields)\n- docs/specs/product-requirements/prd007-links-interface.yaml (Link struct fields, link types)\n- docs/specs/product-requirements/prd008-stash-interface.yaml (Stash struct fields, stash types)\n- docs/ARCHITECTURE.md § Main Interfaces, § System Components, § Design Decisions\n- docs/specs/use-cases/rel01.0-uc004-scaffolding-validation.yaml (compile-time validation criteria)\n\n## Files to Create/Modify\n- pkg/types/config.go (create) — Config struct, config validation errors (ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid)\n- pkg/types/cupboard.go (create) — Cupboard interface (GetTable, Attach, Detach), cupboard lifecycle errors (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound)\n- pkg/types/table.go (create) — Table interface (Get, Set, Delete, Fetch), table operation errors (ErrNotFound, ErrInvalidID, ErrInvalidData), entity method errors (ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter)\n- pkg/types/tables.go (create) — Standard table name constants (CrumbsTable, TrailsTable, PropertiesTable, MetadataTable, LinksTable, StashesTable), StandardTableNames slice\n- pkg/types/crumb.go (create) — Crumb struct with fields (CrumbID, Name, State, CreatedAt, UpdatedAt, Properties), crumb state constants (StateDraft, StatePending, StateReady, StateTaken, StatePebble, StateDust)\n- pkg/types/trail.go (create) — Trail struct with fields (TrailID, State, CreatedAt, CompletedAt), trail state constants (TrailDraft, TrailPending, TrailActive, TrailCompleted, TrailAbandoned)\n- pkg/types/property.go (create) — Property struct (PropertyID, Name, ValueType, CreatedAt) and Category struct (CategoryID, PropertyID, Name, Ordinal)\n- pkg/types/metadata.go (create) — Metadata struct (MetadataID, CrumbID, SchemaName, Content, CreatedAt)\n- pkg/types/link.go (create) — Link struct (LinkID, LinkType, FromID, ToID, CreatedAt), link type constants (LinkBelongsTo, LinkChildOf, LinkBranchesFrom, LinkScopedTo)\n- pkg/types/stash.go (create) — Stash struct (StashID, Name, StashType, Value, Version, HolderID, CreatedAt, UpdatedAt)\n\n## Requirements\n- Define Config struct per prd001-cupboard-core R1.1 with Backend (string) and DataDir (string) fields\n- Define all config validation errors per R1.4\n- Define Cupboard interface per R2.2 with GetTable(name string) (Table, error), Attach(config Config) error, Detach() error\n- Define Table interface per R3.1 with Get(id string) (any, error), Set(id string, data any) (string, error), Delete(id string) error, Fetch(filter map[string]any) ([]any, error)\n- Define all standard error types per R7.1 (cupboard lifecycle), R7.2 (table operations), R7.3 (entity methods)\n- Define standard table name constants per R2.5 and a StandardTableNames slice for enumeration\n- Define all seven entity structs with fields from their respective PRDs: Crumb (prd003 R1.1), Trail (prd006), Property and Category (prd004), Metadata (prd005), Link (prd007), Stash (prd008)\n- Define state constants for Crumb (draft, pending, ready, taken, pebble, dust) and Trail (draft, pending, active, completed, abandoned)\n- Define link type constants (belongs_to, child_of, branches_from, scoped_to)\n- All types must use time.Time for timestamps and string for IDs (UUID v7 per R8)\n- No entity methods yet (those are implementation tasks); only struct definitions and constants\n\n## Design Decisions\n- All types go in pkg/types/ as the shared contract layer between components (per go-style rule and ARCHITECTURE)\n- Interfaces accept and return any; callers use type assertions (per prd001 R3.6)\n- Error sentinels use errors.New for compatibility with errors.Is (per prd001 constraints)\n- State and link type values are string constants, not enums, for JSON compatibility (per prd003 R2.4)\n- No methods on entity structs in this task; entity methods (SetState, Pebble, Dust, etc.) are separate tasks\n\n## Acceptance Criteria\n- [ ] go build ./pkg/types/ compiles without errors\n- [ ] go build ./cmd/cupboard compiles without errors\n- [ ] Config struct has Backend and DataDir fields\n- [ ] Cupboard interface has GetTable, Attach, Detach methods with correct signatures\n- [ ] Table interface has Get, Set, Delete, Fetch methods with correct signatures\n- [ ] All 6 standard table name constants defined\n- [ ] All 7 entity structs defined with fields matching their PRDs\n- [ ] All error sentinels from R7.1, R7.2, R7.3, and R1.4 defined\n- [ ] Crumb state constants defined (6 states)\n- [ ] Trail state constants defined (5 states)\n- [ ] Link type constants defined (4 types)\n- [ ] go vet ./pkg/types/ passes","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T21:33:00.361957-05:00","created_by":"petardjukic","updated_at":"2026-02-11T21:37:05.316778-05:00","closed_at":"2026-02-11T21:37:05.316778-05:00","close_reason":"Closed"}
{"id":"generation-2026-02-11-21-30-20-7dt","title":"Define all entity structs in pkg/types (Crumb, Trail, Property, Category, Metadata, Link, Stash)","description":"## Required Reading\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (Crumb struct, states, state transitions, property methods, filter keys)\n- docs/specs/product-requirements/prd006-trails-interface.yaml (Trail struct, states, Complete/Abandon methods)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (Property struct, Category struct, value types, built-in properties)\n- docs/specs/product-requirements/prd005-metadata-interface.yaml (Metadata struct, schemas)\n- docs/specs/product-requirements/prd007-links-interface.yaml (Link struct, link types, cardinality)\n- docs/specs/product-requirements/prd008-stash-interface.yaml (Stash struct, stash types, versioning)\n- docs/ARCHITECTURE.md § Entity Types (all entity fields and their roles)\n- pkg/types/cupboard.go (from task 0 — Cupboard and Table interfaces these entities work with)\n- pkg/types/table.go (from task 0 — error sentinels used by entity methods)\n\n## Files to Create/Modify\n- pkg/types/crumb.go (create) — Crumb struct with CrumbID, Name, State, Properties map, CreatedAt, UpdatedAt, PebbledAt, DustedAt; CrumbState type and constants (draft, pending, ready, taken, pebble, dust); entity methods SetState, Pebble, Dust, SetProperty, GetProperty, GetProperties, ClearProperty\n- pkg/types/trail.go (create) — Trail struct with TrailID, State, CreatedAt, UpdatedAt, CompletedAt, AbandonedAt; TrailState type and constants (draft, pending, active, completed, abandoned); entity methods Complete, Abandon\n- pkg/types/property.go (create) — Property struct with PropertyID, Name, ValueType, DefaultValue, CreatedAt; ValueType type and constants (categorical, text, integer, boolean, timestamp, list); Category struct with CategoryID, PropertyID, Name, Ordinal, CreatedAt; DefineCategory method\n- pkg/types/metadata.go (create) — Metadata struct with MetadataID, CrumbID, Schema, Content, CreatedAt\n- pkg/types/link.go (create) — Link struct with LinkID, LinkType, FromID, ToID, CreatedAt; LinkType type and constants (belongs_to, child_of, branches_from, scoped_to)\n- pkg/types/stash.go (create) — Stash struct with StashID, Name, StashType, Value, Version, HolderID, CreatedAt, UpdatedAt; StashType type and constants (resource, artifact, context, counter, lock); entity methods SetValue, GetValue, Increment, Acquire, Release\n\n## Requirements\n- Define each entity struct with fields per its PRD\n- Define typed constants for all enumerations (CrumbState, TrailState, LinkType, ValueType, StashType)\n- Implement entity methods that modify struct fields in memory (no persistence — that is Table.Set's job)\n- Crumb.SetState must validate transitions per prd003 state machine\n- Crumb.Pebble must require taken state; Crumb.Dust from any non-terminal state\n- Trail.Complete and Trail.Abandon must set state and timestamps\n- Stash.Increment must work only for counter type; Acquire/Release only for lock type\n- All entity methods return errors from the sentinel set defined in task 0\n- All time fields use time.Time\n- All ID fields are strings (UUID v7 generated by backend, not by entity methods)\n\n## Design Decisions\n- Entity methods modify structs in memory only — the ORM-style pattern means callers call Table.Set to persist\n- Properties map on Crumb is map[string]any (property name → value)\n- State types are string-based typed constants for JSON serialization\n- Follow go-style rule: each struct represents one concept\n- Package doc comments reference the implementing PRDs\n\n## Acceptance Criteria\n- [ ] All 7 entity structs defined with fields matching their PRDs\n- [ ] All enum types have typed constants matching PRD values\n- [ ] Crumb.SetState validates the state machine and returns ErrInvalidTransition for invalid transitions\n- [ ] Crumb.Pebble returns ErrInvalidTransition if state is not taken\n- [ ] Crumb.Dust returns ErrInvalidTransition if state is terminal (pebble or dust)\n- [ ] Trail.Complete sets state to completed and CompletedAt timestamp\n- [ ] Trail.Abandon sets state to abandoned and AbandonedAt timestamp\n- [ ] Stash.Increment returns ErrInvalidStashType if stash type is not counter\n- [ ] Stash.Acquire/Release return ErrInvalidStashType if stash type is not lock\n- [ ] go build ./pkg/types compiles without errors\n- [ ] Package doc comments reference the relevant PRDs","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T21:33:22.231809-05:00","created_by":"petardjukic","updated_at":"2026-02-11T21:33:22.231809-05:00","dependencies":[{"issue_id":"generation-2026-02-11-21-30-20-7dt","depends_on_id":"generation-2026-02-11-21-30-20-14m","type":"blocks","created_at":"2026-02-11T21:33:22.380886-05:00","created_by":"petardjukic"}]}
