{"id":"main-7lx","title":"Implement built-in property seeding and go install support","description":"## Required Reading\n- docs/specs/product-requirements/prd002-sqlite-backend.yaml (R6: built-in property seeding)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (R3: built-in properties)\n- docs/specs/use-cases/rel01.1-uc001-go-install.yaml\n- docs/specs/test-suites/test-rel01.1-uc001-go-install.yaml\n- internal/sqlite/backend.go (from tasks 1-5)\n- internal/sqlite/property.go (from task 5)\n\n## Files to Create/Modify\n- internal/sqlite/seed.go (create) - Built-in property and category seeding\n- internal/sqlite/seed_test.go (create) - Seeding tests\n- internal/sqlite/backend.go (modify) - Call seeding on Attach\n- cmd/cupboard/main.go (modify) - Ensure go install compatibility\n\n## Requirements\n- On Attach: seed built-in properties if not already present\n- Built-in properties: priority (categorical: highest/high/medium/low/lowest), type (categorical: task/epic/bug/chore), description (text), owner (text), labels (list), dependencies (list)\n- Built-in categories: priority categories with display order, type categories with display order\n- Seeding is idempotent: re-attach does not duplicate properties\n- go install github.com/mesh-intelligence/crumbs/cmd/cupboard@latest works\n- Installed binary runs cupboard version, cupboard init, cupboard get/set/list/delete\n\n## Design Decisions\n- Seed data defined as Go constants/variables in seed.go\n- Seeding runs inside Attach transaction (all or nothing)\n- Check existence by property name before inserting\n- go install requires clean module path and no local replace directives in released version\n\n## Acceptance Criteria\n- [ ] Attach seeds 6 built-in properties with correct value types\n- [ ] Attach seeds categories for priority and type properties\n- [ ] Re-attach does not duplicate properties (idempotent)\n- [ ] go build ./cmd/cupboard produces working binary\n- [ ] go vet ./... passes\n- [ ] Binary responds to version, init, get, set, list, delete commands\n- [ ] Test cases from test-rel01.1-uc001-go-install covered\n- [ ] Tests pass: go test ./internal/sqlite/...","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T12:28:56.975079-05:00","created_by":"petardjukic","updated_at":"2026-02-11T12:28:56.975079-05:00","dependencies":[{"issue_id":"main-7lx","depends_on_id":"main-d1l","type":"blocks","created_at":"2026-02-11T12:28:57.987967-05:00","created_by":"petardjukic"}]}
{"id":"main-84l","title":"Implement CLI CRUD commands (get, set, list, delete)","description":"## Required Reading\n- docs/specs/product-requirements/prd009-cupboard-cli.yaml (R4-R5: generic table commands, crumb commands)\n- docs/specs/use-cases/rel01.1-uc004-generic-table-cli.yaml\n- docs/specs/test-suites/test-rel01.1-uc004-generic-table-cli.yaml\n- internal/cli/ (from task 4)\n- internal/sqlite/ (from tasks 1-5)\n\n## Files to Create/Modify\n- internal/cli/get.go (create) - cupboard get \u003ctable\u003e \u003cid\u003e command\n- internal/cli/set.go (create) - cupboard set \u003ctable\u003e \u003cid\u003e --field=value command\n- internal/cli/list.go (create) - cupboard list \u003ctable\u003e [--filter] command\n- internal/cli/delete.go (create) - cupboard delete \u003ctable\u003e \u003cid\u003e command\n- internal/cli/output.go (create) - Human-readable and JSON output formatting\n- internal/cli/commands_test.go (create) - CLI command tests\n\n## Requirements\n- cupboard get \u003ctable\u003e \u003cid\u003e: retrieve entity by ID, print human-readable or --json\n- cupboard set \u003ctable\u003e \u003cid\u003e --field=value: create or update entity\n- cupboard list \u003ctable\u003e: list all entities in table, support --json, --limit, --offset\n- cupboard delete \u003ctable\u003e \u003cid\u003e: delete entity by ID\n- Generic: commands work with any table name (crumbs, trails, links, etc.)\n- Output: human-readable by default, --json flag for JSON output\n- Exit codes: 0 success, 1 user error (not found, invalid args), 2 system error\n- Crumb-specific: cupboard crumb add, crumb get, crumb list, crumb delete (aliases)\n\n## Design Decisions\n- Generic commands accept table name as first positional arg\n- Human-readable output uses formatted key: value pairs\n- JSON output uses json.MarshalIndent\n- Crumb-specific commands are thin wrappers over generic commands with table=\"crumbs\"\n- Each command creates Cupboard, attaches, performs operation, detaches\n\n## Acceptance Criteria\n- [ ] cupboard get crumbs \u003cid\u003e retrieves and prints crumb\n- [ ] cupboard set crumbs \u003cid\u003e --name=X creates or updates crumb\n- [ ] cupboard list crumbs lists all crumbs\n- [ ] cupboard delete crumbs \u003cid\u003e deletes crumb\n- [ ] --json flag produces valid JSON output\n- [ ] Exit code 1 on not-found errors\n- [ ] Commands work for all table types (not just crumbs)\n- [ ] Test cases from test-rel01.1-uc004-generic-table-cli covered\n- [ ] Tests pass: go test ./internal/cli/...","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T12:28:56.665162-05:00","created_by":"petardjukic","updated_at":"2026-02-11T12:28:56.665162-05:00","dependencies":[{"issue_id":"main-84l","depends_on_id":"main-s4z","type":"blocks","created_at":"2026-02-11T12:28:57.686213-05:00","created_by":"petardjukic"}]}
{"id":"main-d1l","title":"Implement Cupboard lifecycle integration tests","description":"## Required Reading\n- docs/specs/use-cases/rel01.0-uc001-cupboard-lifecycle.yaml (full flow F1-F5)\n- docs/specs/test-suites/test-rel01.0-uc001-cupboard-lifecycle.yaml (all test cases)\n- docs/specs/use-cases/rel01.0-uc005-crumbs-table-benchmarks.yaml\n- docs/specs/test-suites/test-rel01.0-uc005-crumbs-table-benchmarks.yaml\n- internal/sqlite/ (all files from tasks 1-5)\n- pkg/types/ (all files from task 0)\n\n## Files to Create/Modify\n- tests/integration/test_rel01_0_uc001_cupboard_lifecycle_test.go (create)\n- tests/integration/test_rel01_0_uc002_table_crud_test.go (create)\n- tests/integration/test_rel01_0_uc003_crumb_lifecycle_test.go (create)\n- tests/integration/test_rel01_0_uc005_crumbs_table_benchmarks_test.go (create)\n- tests/integration/helpers_test.go (create) - Shared test helpers (temp dir setup, cupboard creation)\n\n## Requirements\n- Integration tests covering all test cases from the four rel01.0 test suites\n- Table-driven tests matching YAML test case structure\n- Shared test helpers: create temp directory, initialize cupboard, cleanup\n- Cupboard lifecycle: config → attach → use tables → detach → verify cleanup\n- Table CRUD: Set/Get/Delete/Fetch across entity types with JSONL round-trip\n- Crumb lifecycle: state machine transitions, property operations\n- Benchmarks: Get, Set, Delete, Fetch at 100, 1000, 10000 crumb scales\n- Tests verify JSONL persistence (delete DB, re-attach, data intact)\n\n## Design Decisions\n- Integration tests in tests/integration/ (separate from unit tests in internal/)\n- Each test file corresponds to one YAML test suite\n- helpers_test.go provides NewTestCupboard(t) that creates temp dir and attaches\n- Benchmarks use testing.B with b.ResetTimer after setup\n\n## Acceptance Criteria\n- [ ] All test cases from test-rel01.0-uc001 implemented and passing\n- [ ] All test cases from test-rel01.0-uc002 implemented and passing\n- [ ] All test cases from test-rel01.0-uc003 implemented and passing\n- [ ] Benchmark tests from test-rel01.0-uc005 implemented and running\n- [ ] JSONL round-trip verified (delete DB, re-attach, data survives)\n- [ ] Tests pass: go test ./tests/integration/...\n- [ ] Benchmarks run: go test -bench=. ./tests/integration/...","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T12:28:56.528313-05:00","created_by":"petardjukic","updated_at":"2026-02-11T12:28:56.528313-05:00","dependencies":[{"issue_id":"main-d1l","depends_on_id":"main-rjs","type":"blocks","created_at":"2026-02-11T12:28:57.585091-05:00","created_by":"petardjukic"}]}
{"id":"main-e2c","title":"Implement configuration loading pipeline","description":"## Required Reading\n- docs/specs/product-requirements/prd010-configuration-directories.yaml (all requirements)\n- docs/specs/use-cases/rel01.1-uc003-configuration-loading.yaml (flow and success criteria)\n- docs/specs/test-suites/test-rel01.1-uc003-configuration-loading.yaml\n- docs/engineering/eng03-cupboard-cli.md § Configuration\n- internal/cli/ (from tasks 4, 7)\n\n## Files to Create/Modify\n- internal/config/config.go (create) - Configuration loading with precedence chain\n- internal/config/config_test.go (create) - Configuration loading tests\n- internal/cli/root.go (modify) - Wire config loading into CLI\n\n## Requirements\n- Config directory: .crumbs/ in current directory (default)\n- Config file: .crumbs/config.yaml with backend and data_dir fields\n- Data directory precedence: --data-dir flag \u003e config.yaml data_dir \u003e .crumbs-db/ default\n- Config directory precedence: --config-dir flag \u003e .crumbs/ default\n- Platform defaults for global install (Linux XDG, macOS Library, Windows AppData)\n- Config.yaml parsed with go-yaml/yaml\n- Missing config file uses defaults (not an error)\n- Invalid config file returns user error (exit 1)\n\n## Design Decisions\n- Use spf13/viper for configuration management with YAML support\n- Configuration loaded once at CLI startup, passed to Cupboard via Config struct\n- Platform defaults only for go-installed binary (not project-local usage)\n- Project-local (.crumbs/) takes precedence over platform defaults\n\n## Acceptance Criteria\n- [ ] Default config: backend=sqlite, data_dir=.crumbs-db/\n- [ ] Config.yaml overrides defaults\n- [ ] --data-dir flag overrides config.yaml\n- [ ] --config-dir flag changes config directory\n- [ ] Missing config.yaml uses defaults without error\n- [ ] Invalid config.yaml returns exit code 1\n- [ ] Platform defaults work for Linux, macOS, Windows\n- [ ] Test cases from test-rel01.1-uc003-configuration-loading covered\n- [ ] Tests pass: go test ./internal/config/...","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T12:28:56.832861-05:00","created_by":"petardjukic","updated_at":"2026-02-11T12:28:56.832861-05:00","dependencies":[{"issue_id":"main-e2c","depends_on_id":"main-84l","type":"blocks","created_at":"2026-02-11T12:28:57.863573-05:00","created_by":"petardjukic"}]}
{"id":"main-pxb","title":"Implement SQLite backend foundation (internal/sqlite)","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Cupboard interface contract)\n- docs/specs/product-requirements/prd002-sqlite-backend.yaml (R1-R4: schema, startup, write ops)\n- docs/specs/product-requirements/prd010-configuration-directories.yaml (R1-R3: directory structure)\n- docs/ARCHITECTURE.md § System Components, Technology Choices\n- pkg/types/ (all files from task 0)\n- .claude/rules/go-style.md\n\n## Files to Create/Modify\n- internal/sqlite/backend.go (create) - SQLiteCupboard implementing Cupboard interface\n- internal/sqlite/table.go (create) - SQLiteTable implementing Table interface\n- internal/sqlite/schema.go (create) - DDL statements for all tables\n- internal/sqlite/backend_test.go (create) - Cupboard lifecycle tests\n- go.mod (modify) - Add database/sql and mattn/go-sqlite3 dependencies\n\n## Requirements\n- Implement SQLiteCupboard struct satisfying Cupboard interface\n- Attach: validate config, create DataDir if needed, open SQLite database, create schema\n- Detach: close database, release resources\n- GetTable: return SQLiteTable for known table names, ErrTableNotFound for unknown\n- Implement SQLiteTable struct satisfying Table interface with Get, Set, Delete, Fetch\n- Schema DDL for all entity tables (crumbs, trails, links, properties, categories, metadata, stashes, stash_history)\n- Create .crumbs-db/ data directory per prd010 R1\n- Open cupboard.db inside data directory\n\n## Design Decisions\n- SQLiteCupboard holds *sql.DB and a map[string]*SQLiteTable\n- Tables created lazily on first GetTable call or eagerly on Attach\n- Each SQLiteTable knows its table name and holds a reference to the shared *sql.DB\n- Entity hydration (SQL rows → Go structs) uses JSON serialization for complex fields (properties map, stash value)\n- No JSONL sync in this task (deferred to task 3)\n\n## Acceptance Criteria\n- [ ] SQLiteCupboard satisfies Cupboard interface (compile-time check)\n- [ ] SQLiteTable satisfies Table interface (compile-time check)\n- [ ] Attach creates data directory and initializes schema\n- [ ] GetTable returns Table for all 7 standard table names\n- [ ] GetTable returns ErrTableNotFound for unknown table\n- [ ] Detach closes database; post-detach GetTable returns ErrCupboardDetached\n- [ ] Attach on already-attached cupboard returns ErrAlreadyAttached\n- [ ] Tests pass: go test ./internal/sqlite/...","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T12:28:55.843161-05:00","created_by":"petardjukic","updated_at":"2026-02-11T12:28:55.843161-05:00","dependencies":[{"issue_id":"main-pxb","depends_on_id":"main-xyq","type":"blocks","created_at":"2026-02-11T12:28:57.076926-05:00","created_by":"petardjukic"}]}
{"id":"main-ree","title":"Implement Crumb table operations and state machine","description":"## Required Reading\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (all requirements)\n- docs/specs/product-requirements/prd002-sqlite-backend.yaml (R2: write operations, R5: entity hydration)\n- docs/specs/use-cases/rel01.0-uc003-crumb-lifecycle.yaml (flow and success criteria)\n- docs/specs/test-suites/test-rel01.0-uc003-crumb-lifecycle.yaml (test cases)\n- pkg/types/crumb.go (Crumb struct from task 0)\n- internal/sqlite/backend.go, table.go (from task 1)\n\n## Files to Create/Modify\n- internal/sqlite/crumb.go (create) - Crumb-specific hydration and SQL queries\n- internal/sqlite/crumb_test.go (create) - Crumb CRUD and state machine tests\n- pkg/types/crumb.go (modify) - Add any missing entity methods discovered during implementation\n\n## Requirements\n- Table.Set for crumbs: auto-generate UUID v7 on first Set (new crumb), update existing on subsequent Set\n- Table.Get for crumbs: retrieve by ID, hydrate to *Crumb, return ErrNotFound if missing\n- Table.Delete for crumbs: remove by ID, return ErrNotFound if missing\n- Table.Fetch for crumbs: filter by states, trail_id, parent_id, properties; support limit/offset\n- Crumb state transitions enforced: draft→pending→ready→taken→pebble/dust\n- Invalid state transitions return ErrInvalidStateTransition\n- Crumb properties initialized with defaults on creation\n- SetProperty, GetProperty, ClearProperty operations on Crumb struct\n- Crumb.Pebble() and Crumb.Dust() convenience methods\n\n## Design Decisions\n- UUID v7 generated using google/uuid package\n- Properties stored as JSON column in crumbs table\n- State stored as string column with CHECK constraint\n- Hydration: SQL row → Crumb struct with json.Unmarshal for properties\n- Persistence: Crumb struct → SQL row with json.Marshal for properties\n\n## Acceptance Criteria\n- [ ] Create crumb via Table.Set with auto-generated UUID v7\n- [ ] Get crumb via Table.Get, returns *Crumb\n- [ ] Delete crumb via Table.Delete\n- [ ] Fetch crumbs with state filter returns only matching states\n- [ ] State machine: valid transitions succeed, invalid transitions return error\n- [ ] Pebble() transitions taken→pebble\n- [ ] Dust() transitions taken→dust\n- [ ] Properties initialized with defaults on creation\n- [ ] SetProperty/GetProperty/ClearProperty work correctly\n- [ ] All test cases from test-rel01.0-uc003-crumb-lifecycle covered\n- [ ] Tests pass: go test ./internal/sqlite/...","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T12:28:55.980958-05:00","created_by":"petardjukic","updated_at":"2026-02-11T12:28:55.980958-05:00","dependencies":[{"issue_id":"main-ree","depends_on_id":"main-pxb","type":"blocks","created_at":"2026-02-11T12:28:57.18067-05:00","created_by":"petardjukic"}]}
{"id":"main-rjs","title":"Implement Table CRUD operations for all entity types","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (R2-R3: Table interface, R3: Fetch with filters)\n- docs/specs/product-requirements/prd002-sqlite-backend.yaml (R5: entity hydration for all types)\n- docs/specs/product-requirements/prd006-trails-interface.yaml (Trail struct fields)\n- docs/specs/product-requirements/prd007-links-interface.yaml (Link struct fields, uniqueness)\n- docs/specs/product-requirements/prd005-metadata-interface.yaml (Metadata struct fields)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (Property/Category struct fields)\n- docs/specs/product-requirements/prd008-stash-interface.yaml (Stash struct fields)\n- docs/specs/use-cases/rel01.0-uc002-table-crud.yaml\n- docs/specs/test-suites/test-rel01.0-uc002-table-crud.yaml\n- internal/sqlite/crumb.go (Crumb hydration pattern from task 2)\n\n## Files to Create/Modify\n- internal/sqlite/trail.go (create) - Trail hydration and SQL queries\n- internal/sqlite/link.go (create) - Link hydration, uniqueness constraint\n- internal/sqlite/property.go (create) - Property and Category hydration\n- internal/sqlite/metadata.go (create) - Metadata hydration\n- internal/sqlite/stash.go (create) - Stash hydration\n- internal/sqlite/table_crud_test.go (create) - Cross-entity CRUD tests\n\n## Requirements\n- Get, Set, Delete, Fetch for: trails, links, properties, categories, metadata, stashes\n- Trail: UUID v7, state field, CreatedAt, CompletedAt\n- Link: UUID v7, LinkType, FromID, ToID, CreatedAt; uniqueness on (link_type, from_id, to_id)\n- Property: UUID v7, Name, ValueType, DefaultValue, CreatedAt\n- Category: UUID v7, PropertyID, Name, DisplayOrder\n- Metadata: UUID v7, CrumbID, TableName (schema), Content, PropertyID, CreatedAt\n- Stash: UUID v7, Name, StashType, Value (JSON), Version, CreatedAt, LastOperation, ChangedBy\n- Fetch filters per entity type (e.g., links by from_id/to_id/link_type, metadata by schema/crumb_id)\n- Hydration follows same pattern as Crumb (task 2)\n\n## Design Decisions\n- Each entity type has its own file with hydration functions\n- SQLiteTable dispatches to entity-specific hydration based on table name\n- Link uniqueness enforced at SQL level (UNIQUE constraint) and checked in Set\n- JSON columns for complex fields (Stash.Value, Property.DefaultValue)\n\n## Acceptance Criteria\n- [ ] CRUD operations work for all 7 entity types\n- [ ] Link uniqueness constraint enforced (duplicate returns error)\n- [ ] Fetch filters work per entity type\n- [ ] Type assertions succeed: Table.Get returns correct entity pointer type\n- [ ] ErrNotFound returned for Get/Delete of nonexistent entity\n- [ ] Test cases from test-rel01.0-uc002-table-crud covered\n- [ ] Tests pass: go test ./internal/sqlite/...","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T12:28:56.392186-05:00","created_by":"petardjukic","updated_at":"2026-02-11T12:28:56.392186-05:00","dependencies":[{"issue_id":"main-rjs","depends_on_id":"main-rvc","type":"blocks","created_at":"2026-02-11T12:28:57.483901-05:00","created_by":"petardjukic"}]}
{"id":"main-rvc","title":"Implement JSONL persistence layer","description":"## Required Reading\n- docs/specs/product-requirements/prd002-sqlite-backend.yaml (R1: JSONL layout, R2: write operations with JSONL sync, R3: sync strategies)\n- docs/specs/product-requirements/prd010-configuration-directories.yaml (R2: JSONL file format, R4: atomic write)\n- docs/specs/use-cases/rel01.0-uc002-table-crud.yaml (JSONL persistence flow)\n- docs/specs/test-suites/test-rel01.0-uc002-table-crud.yaml\n- docs/engineering/eng01-git-integration.md (JSONL in git)\n- internal/sqlite/ (backend from tasks 1-2)\n\n## Files to Create/Modify\n- internal/sqlite/jsonl.go (create) - JSONL read/write with atomic file operations\n- internal/sqlite/sync.go (create) - Sync strategies (immediate, on_close, batch)\n- internal/sqlite/jsonl_test.go (create) - JSONL round-trip tests\n- internal/sqlite/backend.go (modify) - Wire JSONL loading on Attach, JSONL sync on write\n\n## Requirements\n- JSONL file layout: one file per table in .crumbs-db/ directory (crumbs.jsonl, trails.jsonl, etc.)\n- On Attach: load JSONL files into SQLite (hydrate all entities)\n- On write (Set/Delete): persist to both SQLite and JSONL (immediate sync by default)\n- Atomic write pattern: write to temp file, fsync, rename\n- JSONL format: one JSON object per line, no pretty-printing\n- On Detach with on_close strategy: flush pending writes to JSONL\n- JSONL files survive database deletion (test: delete cupboard.db, re-attach, data intact)\n\n## Design Decisions\n- JSONL writer is a separate component injected into SQLiteTable\n- Sync strategy configurable in Config (default: immediate)\n- Each JSONL file contains all entities for that table (full rewrite on sync for simplicity)\n- Entity serialization uses json.Marshal with field tags\n- Stable insertion order in JSONL for clean git diffs\n\n## Acceptance Criteria\n- [ ] JSONL files created on first write to each table\n- [ ] Atomic write: temp file → fsync → rename pattern\n- [ ] Round-trip: write entity → delete cupboard.db → re-attach → entity recovered from JSONL\n- [ ] Immediate sync: JSONL updated after every Set/Delete\n- [ ] JSONL format: one JSON object per line, no trailing whitespace\n- [ ] Stable ordering: entities in JSONL sorted by ID (or insertion order) for git-friendly diffs\n- [ ] Test cases from test-rel01.0-uc002-table-crud covered\n- [ ] Tests pass: go test ./internal/sqlite/...","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T12:28:56.120667-05:00","created_by":"petardjukic","updated_at":"2026-02-11T12:28:56.120667-05:00","dependencies":[{"issue_id":"main-rvc","depends_on_id":"main-ree","type":"blocks","created_at":"2026-02-11T12:28:57.281632-05:00","created_by":"petardjukic"}]}
{"id":"main-s4z","title":"Implement CLI scaffolding with cobra (version, init commands)","description":"## Required Reading\n- docs/specs/product-requirements/prd009-cupboard-cli.yaml (R1: root command, R2: init, R3: version)\n- docs/specs/product-requirements/prd010-configuration-directories.yaml (R1: config directory, R3: config.yaml)\n- docs/specs/use-cases/rel01.0-uc004-scaffolding-validation.yaml (flow and success criteria)\n- docs/specs/test-suites/test-rel01.0-uc004-scaffolding-validation.yaml\n- docs/ARCHITECTURE.md § Project Structure\n- .claude/rules/go-style.md\n\n## Files to Create/Modify\n- cmd/cupboard/main.go (modify) - Wire cobra root command\n- internal/cli/root.go (create) - Root command with global flags (--config-dir, --data-dir, --help, --version)\n- internal/cli/version.go (create) - Version command\n- internal/cli/init.go (create) - Init command (creates .crumbs/ and config.yaml)\n- internal/cli/root_test.go (create) - CLI integration tests\n- go.mod (modify) - Add spf13/cobra dependency\n\n## Requirements\n- Root command: cupboard with --config-dir, --data-dir, --help, --version flags\n- Version command: cupboard version prints version string, exits 0\n- Init command: cupboard init creates .crumbs/ directory and config.yaml with defaults\n- Exit codes: 0 (success), 1 (user error), 2 (system error)\n- Global flags propagated to all subcommands\n- Config directory defaults to .crumbs/ in current directory\n- Data directory defaults to .crumbs-db/ in current directory\n\n## Design Decisions\n- Use spf13/cobra for CLI framework\n- Each command in its own file in internal/cli/\n- Root command creates Cupboard and attaches on commands that need storage\n- Version command does not require storage (no attach)\n- Init is idempotent: running twice does not overwrite existing config\n\n## Acceptance Criteria\n- [ ] go build ./cmd/cupboard produces working binary\n- [ ] cupboard version prints version and exits 0\n- [ ] cupboard init creates .crumbs/ directory with config.yaml\n- [ ] cupboard init on existing directory is idempotent\n- [ ] cupboard --help shows available commands\n- [ ] Exit code 1 on user errors (e.g., unknown command)\n- [ ] Global --data-dir flag overrides default data directory\n- [ ] Test cases from test-rel01.0-uc004-scaffolding-validation covered\n- [ ] Tests pass: go test ./internal/cli/...","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T12:28:56.256155-05:00","created_by":"petardjukic","updated_at":"2026-02-11T12:28:56.256155-05:00","dependencies":[{"issue_id":"main-s4z","depends_on_id":"main-pxb","type":"blocks","created_at":"2026-02-11T12:28:57.383109-05:00","created_by":"petardjukic"}]}
{"id":"main-xyq","title":"Implement core types and interfaces (pkg/types)","description":"## Required Reading\n- docs/ARCHITECTURE.md § System Overview, Main Interfaces\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (R1-R7)\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (R1: Crumb struct)\n- docs/specs/product-requirements/prd006-trails-interface.yaml (R1: Trail struct)\n- docs/specs/product-requirements/prd007-links-interface.yaml (R1: Link struct)\n- docs/specs/product-requirements/prd005-metadata-interface.yaml (R1: Metadata struct)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (R1: Property/Category structs)\n- docs/specs/product-requirements/prd008-stash-interface.yaml (R1: Stash struct)\n- .claude/rules/go-style.md\n\n## Files to Create/Modify\n- pkg/types/config.go (create) - Config struct with Backend, DataDir\n- pkg/types/cupboard.go (create) - Cupboard interface (Attach, Detach, GetTable)\n- pkg/types/table.go (create) - Table interface (Get, Set, Delete, Fetch)\n- pkg/types/errors.go (create) - Standard error types (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound, etc.)\n- pkg/types/crumb.go (create) - Crumb struct with state constants and entity methods\n- pkg/types/trail.go (create) - Trail struct with state constants\n- pkg/types/link.go (create) - Link struct with link type constants\n- pkg/types/property.go (create) - Property and Category structs\n- pkg/types/metadata.go (create) - Metadata struct\n- pkg/types/stash.go (create) - Stash struct with stash type constants\n- pkg/types/filter.go (create) - Filter type (map[string]any)\n\n## Requirements\n- Define Config struct per prd001-cupboard-core R1 (Backend string, DataDir string)\n- Define Cupboard interface per prd001-cupboard-core R2 (Attach, Detach, GetTable)\n- Define Table interface per prd001-cupboard-core R2 (Get, Set, Delete, Fetch)\n- Define all entity structs: Crumb (with state machine constants), Trail (with lifecycle states), Link (with type constants), Property, Category, Metadata, Stash\n- Define standard error variables per prd001-cupboard-core R5\n- Define Filter type per prd001-cupboard-core R3\n- All IDs use UUID v7 (string type, generation deferred to implementation)\n- Entity methods on Crumb (SetState, Pebble, Dust, SetProperty, GetProperty, ClearProperty)\n- Entity methods on Trail (Complete, Abandon - state transitions only, no cascade logic)\n- Standard table name constants: crumbs, trails, properties, categories, metadata, links, stashes\n\n## Design Decisions\n- pkg/types contains only interfaces, structs, constants, and error variables — no implementation\n- Cupboard.GetTable returns Table interface; callers type-assert entities from Get results\n- Filter is map[string]any; backends interpret filter keys\n- State transitions validated in entity methods (return error for invalid transitions)\n- Stash entity methods (Increment, Acquire, Release) defined on struct but orchestration is backend responsibility\n\n## Acceptance Criteria\n- [ ] All entity structs compile with fields matching PRD definitions\n- [ ] Cupboard interface has Attach(Config) error, Detach() error, GetTable(string) (Table, error)\n- [ ] Table interface has Get(string) (any, error), Set(string, any) error, Delete(string) error, Fetch(Filter) ([]any, error)\n- [ ] Standard error variables defined and work with errors.Is\n- [ ] Crumb state machine: draft→pending→ready→taken→pebble/dust transitions validated\n- [ ] Trail state machine: draft→pending→active→completed/abandoned transitions validated\n- [ ] go build ./pkg/types succeeds\n- [ ] Unit tests for state transition validation on Crumb and Trail","status":"in_progress","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T12:28:55.704574-05:00","created_by":"petardjukic","updated_at":"2026-02-11T12:29:11.373436-05:00"}
