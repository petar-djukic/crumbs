{"id":"generation-2026-02-12-07-06-54-9e6","title":"Define Cupboard and Table interfaces and error types in pkg/types","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Config, Cupboard, Table interfaces, error types, UUID v7)\n- docs/ARCHITECTURE.md ยง System Overview, ยง Main Interfaces\n- docs/specs/use-cases/rel01.0-uc001-cupboard-lifecycle.yaml (lifecycle flow and success criteria)\n- docs/specs/use-cases/rel01.0-uc004-scaffolding-validation.yaml (compile validation)\n\n## Files to Create/Modify\n- pkg/types/config.go (create) - Config struct, config validation errors, Validate method\n- pkg/types/cupboard.go (create) - Cupboard interface, cupboard lifecycle errors (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound)\n- pkg/types/table.go (create) - Table interface (Get, Set, Delete, Fetch), table operation errors (ErrNotFound, ErrInvalidID, ErrInvalidData), entity method errors (ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter), Filter type alias, standard table name constants\n- pkg/types/doc.go (create) - Package documentation linking to PRDs\n\n## Requirements\n- Define Config struct with Backend (string) and DataDir (string) fields per prd001 R1\n- Define Config.Validate() method that checks Backend non-empty and recognized, DataDir non-empty when Backend is sqlite per prd001 R1.2-R1.3\n- Define config validation errors: ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid per prd001 R1.4\n- Define Cupboard interface with GetTable(name string) (Table, error), Attach(config Config) error, Detach() error per prd001 R2\n- Define Table interface with Get(id string) (any, error), Set(id string, data any) (string, error), Delete(id string) error, Fetch(filter map[string]any) ([]any, error) per prd001 R3\n- Define Filter type alias: type Filter = map[string]any per prd003 R9.1\n- Define standard table name constants: crumbs, trails, properties, metadata, links, stashes per prd001 R2.5\n- Define all sentinel errors from prd001 R7.1 (cupboard lifecycle), R7.2 (table operations), R7.3 (entity method errors)\n- All errors must be checkable with errors.Is per prd001 R7\n\n## Design Decisions\n- pkg/types is the contract layer: interfaces and types only, no implementation\n- Config struct is a plain value type (no methods beyond Validate)\n- Table returns any; callers type-assert to concrete entity structs\n- Filter is a type alias for map[string]any (not a named type) for ease of use\n- Standard table names are string constants, not an enum\n- Group errors by scope: config errors in config.go, cupboard errors in cupboard.go, table/entity errors in table.go\n\n## Acceptance Criteria\n- [ ] Config struct compiles with Backend and DataDir fields\n- [ ] Config.Validate() returns appropriate errors for invalid configurations\n- [ ] Cupboard interface compiles with GetTable, Attach, Detach\n- [ ] Table interface compiles with Get, Set, Delete, Fetch\n- [ ] All 6 standard table name constants defined\n- [ ] All sentinel errors from prd001 R7.1, R7.2, R7.3 defined\n- [ ] Filter type alias defined\n- [ ] go build ./pkg/types succeeds\n- [ ] Package doc comment references prd001-cupboard-core","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:09:31.605907-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:11:30.96295-05:00","closed_at":"2026-02-12T07:11:30.96295-05:00","close_reason":"Closed"}
{"id":"generation-2026-02-12-07-06-54-b6i","title":"Define Crumb entity struct and state transition methods in pkg/types","description":"## Required Reading\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (Crumb struct, state machine, entity methods, property methods)\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Table interface contract, error types)\n- docs/ARCHITECTURE.md ยง Entity Types, ยง ORM Pattern\n- docs/specs/use-cases/rel01.0-uc003-crumb-lifecycle.yaml (state transitions, creation, deletion)\n- pkg/types/table.go (error types defined in task 0)\n- pkg/types/cupboard.go (interfaces defined in task 0)\n\n## Files to Create/Modify\n- pkg/types/crumb.go (create) - Crumb struct, state constants, state transition methods (SetState, Pebble, Dust), property methods (SetProperty, GetProperty, GetProperties, ClearProperty)\n\n## Requirements\n- Define Crumb struct with CrumbID (string), Name (string), State (string), CreatedAt (time.Time), UpdatedAt (time.Time), Properties (map[string]any) per prd003 R1.1\n- Define state constants: StateDraft, StatePending, StateReady, StateTaken, StatePebble, StateDust per prd003 R2.1\n- Define ValidStates set or slice for state validation\n- Implement SetState(state string) error: validate state is in ValidStates (return ErrInvalidState if not), set State field, update UpdatedAt, idempotent per prd003 R4.2\n- Implement Pebble() error: validate current state is taken (return ErrInvalidTransition if not), set State to pebble, update UpdatedAt per prd003 R4.3\n- Implement Dust() error: set State to dust from any state, update UpdatedAt, idempotent per prd003 R4.4\n- Implement SetProperty(propertyID string, value any) error: set value in Properties map, update UpdatedAt per prd003 R5.2 (note: full type validation deferred to Table.Set per R5.7)\n- Implement GetProperty(propertyID string) (any, error): return value from Properties map, return ErrPropertyNotFound if missing per prd003 R5.3\n- Implement GetProperties() map[string]any: return Properties map per prd003 R5.4\n- Implement ClearProperty(propertyID string) error: set property to zero value, update UpdatedAt, return ErrPropertyNotFound if missing per prd003 R5.5 (note: full default lookup deferred to Table.Set)\n\n## Design Decisions\n- Crumb is a plain struct in pkg/types with methods that modify in-memory state only\n- State constants are string constants (not iota) for JSON compatibility per prd003 R2.4\n- Property validation (type checking, category validation) is deferred to Table.Set per prd003 R5.7; entity methods do minimal validation\n- ClearProperty sets to zero value of Go type (empty string, 0, nil slice) as a placeholder; full default lookup requires property definitions table\n- No constructor function needed; callers build Crumb structs directly and pass to Table.Set per prd003 R3.1\n\n## Acceptance Criteria\n- [ ] Crumb struct compiles with all 6 fields from prd003 R1.1\n- [ ] 6 state constants defined matching prd003 R2.1 values\n- [ ] SetState validates state and returns ErrInvalidState for unknown states\n- [ ] SetState is idempotent (setting current state succeeds)\n- [ ] Pebble returns ErrInvalidTransition when state is not taken\n- [ ] Pebble sets state to pebble and updates UpdatedAt when state is taken\n- [ ] Dust sets state to dust from any state and updates UpdatedAt\n- [ ] Dust is idempotent\n- [ ] GetProperty returns ErrPropertyNotFound for missing property\n- [ ] SetProperty updates Properties map and UpdatedAt\n- [ ] GetProperties returns the Properties map\n- [ ] ClearProperty returns ErrPropertyNotFound for missing property\n- [ ] go build ./pkg/types succeeds\n- [ ] File doc comment references prd003-crumbs-interface","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:09:31.740865-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:09:31.740865-05:00","dependencies":[{"issue_id":"generation-2026-02-12-07-06-54-b6i","depends_on_id":"generation-2026-02-12-07-06-54-9e6","type":"blocks","created_at":"2026-02-12T07:09:31.842365-05:00","created_by":"petardjukic"}]}
