{"id":"generation-2026-02-12-07-13-55-57l","title":"Define Config struct, Cupboard interface, and Table interface in pkg/types","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (R1-R3, R7-R8)\n- docs/ARCHITECTURE.md ยง Main Interface, ยง Design Decisions\n\n## Files to Create/Modify\n- pkg/types/config.go (create) - Config struct with Backend, DataDir fields; config validation errors (ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid); Validate() method\n- pkg/types/cupboard.go (create) - Cupboard interface with GetTable, Attach, Detach; standard table name constants; cupboard lifecycle errors (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound)\n- pkg/types/table.go (create) - Table interface with Get, Set, Delete, Fetch; table operation errors (ErrNotFound, ErrInvalidID, ErrInvalidData, ErrInvalidFilter); Filter type alias\n\n## Requirements\n- Config struct with Backend (string) and DataDir (string) fields per prd001 R1\n- Config.Validate() checks Backend not empty, Backend recognized, DataDir not empty when Backend is \"sqlite\"\n- Cupboard interface: GetTable(name string) (Table, error), Attach(config Config) error, Detach() error\n- Table interface: Get(id string) (any, error), Set(id string, data any) (string, error), Delete(id string) error, Fetch(filter map[string]any) ([]any, error)\n- Standard table name constants: crumbs, trails, properties, metadata, links, stashes\n- All sentinel errors defined per prd001 R7 with errors.New\n- Filter type alias: type Filter = map[string]any\n\n## Design Decisions\n- Interfaces in pkg/types (shared contract layer); implementations in internal/\n- Config struct, not interface, for serialization compatibility\n- Sentinel errors for errors.Is compatibility\n\n## Acceptance Criteria\n- [ ] Config struct compiles with Backend and DataDir fields\n- [ ] Config.Validate() returns correct errors for empty/unknown backend, empty DataDir\n- [ ] Cupboard interface compiles with GetTable, Attach, Detach\n- [ ] Table interface compiles with Get, Set, Delete, Fetch\n- [ ] All 6 standard table name constants defined\n- [ ] All sentinel errors from prd001 R7.1-R7.3 defined\n- [ ] go build ./pkg/types succeeds","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:18:35.592955-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:18:35.592955-05:00"}
{"id":"generation-2026-02-12-07-13-55-5w8","title":"Unit tests for pkg/types: Config, Crumb, Trail entity methods","description":"## Required Reading\n- pkg/types/config.go (Config struct, Validate)\n- pkg/types/crumb.go (Crumb struct, state methods, property methods)\n- pkg/types/trail.go (Trail struct, Complete, Abandon)\n- docs/specs/test-suites/test-rel01.0-uc001-cupboard-lifecycle.yaml (config validation test cases)\n- docs/specs/test-suites/test-rel01.0-uc003-crumb-lifecycle.yaml (state transition test cases)\n\n## Files to Create/Modify\n- pkg/types/config_test.go (create) - Table-driven tests for Config.Validate: valid config, empty backend, unknown backend, empty DataDir for sqlite\n- pkg/types/crumb_test.go (create) - Table-driven tests for SetState (valid states, invalid state, idempotent), Pebble (from taken OK, from other states fails), Dust (from any state OK, idempotent), property methods (SetProperty, GetProperty, ClearProperty)\n- pkg/types/trail_test.go (create) - Table-driven tests for Complete (from active OK, from other states fails), Abandon (from active OK, from other states fails)\n\n## Requirements\n- Use testify/assert for assertions\n- Table-driven tests: each YAML test case maps to one row\n- Test edge cases: zero values, nil Properties map, empty strings\n- Test all error conditions return correct sentinel errors\n\n## Design Decisions\n- Tests in pkg/types package (white-box testing of entity methods)\n- Use testify for readable assertions\n\n## Acceptance Criteria\n- [ ] Config validation tests cover all error paths\n- [ ] Crumb state transition tests cover all valid/invalid transitions\n- [ ] Crumb property method tests cover set/get/clear/not-found\n- [ ] Trail lifecycle tests cover Complete and Abandon\n- [ ] All tests pass: go test ./pkg/types/...\n- [ ] No test uses hardcoded UUIDs (generate or use constants)","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:18:36.54853-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:18:36.54853-05:00","dependencies":[{"issue_id":"generation-2026-02-12-07-13-55-5w8","depends_on_id":"generation-2026-02-12-07-13-55-eow","type":"blocks","created_at":"2026-02-12T07:18:37.516488-05:00","created_by":"petardjukic"}]}
{"id":"generation-2026-02-12-07-13-55-68l","title":"Define SQLite backend configuration and constructor in internal/sqlite","description":"## Required Reading\n- docs/specs/product-requirements/prd002-sqlite-backend.yaml (R1 directory layout, R4 startup, R16 sync strategy)\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (R1 Config, R4 Attach)\n- pkg/types/config.go (Config struct)\n- pkg/types/cupboard.go (Cupboard interface)\n\n## Files to Create/Modify\n- internal/sqlite/backend.go (create) - SQLiteBackend struct implementing Cupboard interface; SQLiteConfig struct with SyncStrategy, BatchSize, BatchInterval; NewBackend() constructor; GetTable, Attach, Detach method stubs; attached/detached state tracking\n- internal/sqlite/schema.go (create) - SQL schema DDL strings (all 9 CREATE TABLE statements, all 12 CREATE INDEX statements from prd002 R3)\n\n## Requirements\n- SQLiteBackend struct with: db connection, attached flag, mutex for state, map of table accessors, config\n- NewBackend() returns *SQLiteBackend (not attached)\n- Attach(config): validate config, create DataDir if needed, create empty JSONL files if needed, delete existing cupboard.db, create new cupboard.db with schema, mark as attached; return ErrAlreadyAttached if already attached\n- Detach(): mark as detached, close db; idempotent\n- GetTable(name): return table accessor from map or ErrTableNotFound; return ErrCupboardDetached if detached\n- Schema DDL as const strings per prd002 R3.2 and R3.3\n\n## Design Decisions\n- Use modernc.org/sqlite (pure Go, no CGO) per architecture doc\n- Single backend.go for the struct and lifecycle; schema.go for DDL constants\n- Table accessors created during Attach and cached\n\n## Acceptance Criteria\n- [ ] SQLiteBackend implements Cupboard interface (compile check)\n- [ ] NewBackend returns unattached backend\n- [ ] Attach creates DataDir and JSONL files\n- [ ] Attach creates cupboard.db with correct schema\n- [ ] Detach closes connection and marks detached\n- [ ] GetTable returns ErrTableNotFound for unknown names\n- [ ] GetTable returns ErrCupboardDetached after Detach\n- [ ] go build ./internal/sqlite succeeds","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:18:35.991338-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:18:35.991338-05:00","dependencies":[{"issue_id":"generation-2026-02-12-07-13-55-68l","depends_on_id":"generation-2026-02-12-07-13-55-eow","type":"blocks","created_at":"2026-02-12T07:18:37.109887-05:00","created_by":"petardjukic"}]}
{"id":"generation-2026-02-12-07-13-55-6dx","title":"Implement metadata, stashes table accessors and JSONL loading","description":"## Required Reading\n- docs/specs/product-requirements/prd005-metadata-interface.yaml (Metadata entity, schemas)\n- docs/specs/product-requirements/prd008-stash-interface.yaml (Stash entity, history, operations)\n- docs/specs/product-requirements/prd002-sqlite-backend.yaml (R4 startup sequence, R9 built-in properties seeding)\n- internal/sqlite/backend.go (Attach method)\n\n## Files to Create/Modify\n- internal/sqlite/metadata_table.go (create) - metadataTable implementing Table; Fetch supports filter by table_name, crumb_id, property_id, content_contains, limit, offset\n- internal/sqlite/stashes_table.go (create) - stashesTable implementing Table; Set handles version increment and history append to stash_history; stash_history JSONL persistence\n- internal/sqlite/loader.go (create) - JSONL loading functions for startup: loadAllJSONL reads each JSONL file and inserts into SQLite tables; seedBuiltInProperties creates priority/type/description/owner/labels properties and categories if properties.jsonl is empty per prd002 R9\n- internal/sqlite/backend.go (modify) - Wire Attach to call loader, create all 6 table accessors, store in map\n\n## Requirements\n- metadataTable: hydrate/dehydrate Metadata per prd002 R14.5; Fetch with schema name, crumb_id, content_contains filters\n- stashesTable: hydrate/dehydrate Stash per prd002 R14.7; Set increments Version, records StashHistoryEntry, persists to stashes.jsonl and stash_history.jsonl\n- Loader: read each JSONL file line by line, parse JSON, insert into SQLite; skip malformed lines with warning; seed built-in properties per prd002 R9\n- Wire all 6 table accessors into backend.Attach\n\n## Design Decisions\n- Stash history append-only: never rewrite stash_history.jsonl, only append\n- Built-in properties seeded only if properties.jsonl is empty (first run)\n- Loader is transactional per prd002 R4.4\n\n## Acceptance Criteria\n- [ ] metadataTable implements Table with filtering\n- [ ] stashesTable implements Table with version/history tracking\n- [ ] Loader reads JSONL files into SQLite on Attach\n- [ ] Built-in properties seeded on first startup\n- [ ] Attach creates all 6 table accessors\n- [ ] go build ./internal/sqlite succeeds","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:18:36.409817-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:18:36.409817-05:00","dependencies":[{"issue_id":"generation-2026-02-12-07-13-55-6dx","depends_on_id":"generation-2026-02-12-07-13-55-ny9","type":"blocks","created_at":"2026-02-12T07:18:37.415895-05:00","created_by":"petardjukic"}]}
{"id":"generation-2026-02-12-07-13-55-755","title":"Wire CLI with cobra: init and version commands using Cupboard","description":"## Required Reading\n- docs/specs/product-requirements/prd009-cupboard-cli.yaml (init, version commands)\n- docs/specs/product-requirements/prd010-configuration-directories.yaml (config/data directory defaults)\n- docs/specs/use-cases/rel01.0-uc004-scaffolding-validation.yaml (CLI version, tables accessible)\n- cmd/cupboard/main.go (existing entry point)\n- pkg/crumbs/version.go (version constant)\n\n## Files to Create/Modify\n- cmd/cupboard/main.go (modify) - Replace print-only main with cobra root command\n- cmd/cupboard/root.go (create) - Root cobra command with --config-dir, --data-dir, --json global flags\n- cmd/cupboard/init.go (create) - Init command: creates data directory, initializes backend (Attach + Detach), seeds built-in properties\n- cmd/cupboard/version.go (create) - Version command: prints version string\n\n## Requirements\n- Root command \"cupboard\" with persistent flags: --config-dir, --data-dir, --json, --help, --version\n- \"cupboard init\" creates .crumbs-db directory (or custom data-dir), calls Attach to initialize backend and JSONL files, then Detach\n- \"cupboard version\" prints version string from pkg/crumbs/version.go\n- Exit codes: 0 success, 1 user error, 2 system error per prd009\n- Config/data directory defaults per prd010: $(CWD)/.crumbs for config, $(CWD)/.crumbs-db for data\n\n## Design Decisions\n- Use cobra for CLI framework per go-style rule\n- Minimal CLI: only init and version for release 01.0\n- Wire real SQLiteBackend in init command\n\n## Acceptance Criteria\n- [ ] cupboard version prints version and exits 0\n- [ ] cupboard init creates data directory with JSONL files\n- [ ] cupboard init seeds built-in properties\n- [ ] cupboard --help shows available commands\n- [ ] go build ./cmd/cupboard succeeds\n- [ ] go install ./cmd/cupboard succeeds","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:18:36.814753-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:18:36.814753-05:00","dependencies":[{"issue_id":"generation-2026-02-12-07-13-55-755","depends_on_id":"generation-2026-02-12-07-13-55-6dx","type":"blocks","created_at":"2026-02-12T07:18:37.712143-05:00","created_by":"petardjukic"}]}
{"id":"generation-2026-02-12-07-13-55-a1t","title":"Implement crumbs table accessor with Get, Set, Delete, Fetch","description":"## Required Reading\n- docs/specs/product-requirements/prd002-sqlite-backend.yaml (R12-R15 table routing, interface impl, hydration, persistence)\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (R3 creation, R6-R10 retrieval/update/delete/filter/query)\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (R3 Table interface, R8 UUID v7)\n- internal/sqlite/backend.go (SQLiteBackend, schema)\n- pkg/types/crumb.go (Crumb struct)\n\n## Files to Create/Modify\n- internal/sqlite/crumbs_table.go (create) - crumbsTable struct implementing Table interface; Get (query by ID, hydrate to *Crumb), Set (create with UUID v7 if empty ID, update if exists; validate Name non-empty; dehydrate to SQL), Delete (remove crumb + cascade property values/metadata/links), Fetch (build WHERE from filter map, hydrate results)\n- internal/sqlite/jsonl.go (create) - JSONL read/write helpers: readJSONL(path) ([]json.RawMessage, error), writeJSONL(path, records) with atomic write pattern (temp file, fsync, rename); loadCrumbsJSONL, persistCrumbsJSONL\n\n## Requirements\n- crumbsTable.Get: query crumbs table by crumb_id, hydrate row to *Crumb per prd002 R14.2, return ErrNotFound/ErrInvalidID\n- crumbsTable.Set: type-assert data to *Crumb, validate Name non-empty (ErrInvalidName), generate UUID v7 if CrumbID empty, set CreatedAt/UpdatedAt/State=draft on create, INSERT or UPDATE, persist to crumbs.jsonl atomically\n- crumbsTable.Delete: delete from crumbs table + cascade (crumb_properties, metadata, links where from_id or to_id), persist affected JSONL files, return ErrNotFound/ErrInvalidID\n- crumbsTable.Fetch: support filters (states, trail_id, parent_id, limit, offset), order by created_at DESC, return []any of *Crumb\n- JSONL helpers: atomic write (write temp, fsync, rename), read line-by-line skipping empty/malformed\n- UUID v7 generation using google/uuid package\n\n## Design Decisions\n- Each table accessor owns its JSONL persistence\n- Atomic write pattern per prd002 R5.2\n- Filter keys map to SQL WHERE clauses; trail_id and parent_id require JOIN on links table\n\n## Acceptance Criteria\n- [ ] crumbsTable implements Table interface\n- [ ] Get returns hydrated *Crumb or ErrNotFound\n- [ ] Set creates crumb with UUID v7 and correct defaults\n- [ ] Set updates existing crumb\n- [ ] Delete cascades to properties, metadata, links\n- [ ] Fetch with empty filter returns all crumbs\n- [ ] Fetch respects states, limit, offset filters\n- [ ] JSONL atomic write pattern works (temp, fsync, rename)\n- [ ] go build ./internal/sqlite succeeds","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:18:36.124514-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:18:36.124514-05:00","dependencies":[{"issue_id":"generation-2026-02-12-07-13-55-a1t","depends_on_id":"generation-2026-02-12-07-13-55-68l","type":"blocks","created_at":"2026-02-12T07:18:37.208079-05:00","created_by":"petardjukic"}]}
{"id":"generation-2026-02-12-07-13-55-eow","title":"Define Crumb property methods and remaining entity structs in pkg/types","description":"## Required Reading\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (R5 property methods)\n- docs/specs/product-requirements/prd006-trails-interface.yaml (Trail struct)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (Property and Category structs)\n- docs/specs/product-requirements/prd005-metadata-interface.yaml (Metadata struct)\n- docs/specs/product-requirements/prd007-links-interface.yaml (Link struct)\n- docs/specs/product-requirements/prd008-stash-interface.yaml (Stash struct)\n- pkg/types/crumb.go (existing Crumb struct)\n\n## Files to Create/Modify\n- pkg/types/crumb.go (modify) - Add property methods: SetProperty, GetProperty, GetProperties, ClearProperty\n- pkg/types/trail.go (create) - Trail struct with ID, State, CreatedAt, CompletedAt; Complete() and Abandon() methods\n- pkg/types/property.go (create) - Property struct, Category struct, value type constants, built-in property names\n- pkg/types/metadata.go (create) - Metadata struct, Schema struct, built-in schema constants\n- pkg/types/link.go (create) - Link struct, link type constants (belongs_to, child_of, branches_from, scoped_to)\n- pkg/types/stash.go (create) - Stash struct, StashHistoryEntry struct, stash type constants, stash methods\n- pkg/types/errors.go (create) - Entity-specific errors not already in table.go (ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, etc.)\n\n## Requirements\n- Crumb property methods per prd003 R5: SetProperty, GetProperty, GetProperties, ClearProperty\n- Trail struct per prd006: TrailID, State, CreatedAt, CompletedAt (*time.Time); Complete(), Abandon() methods\n- Property and Category structs per prd004\n- Metadata struct per prd005\n- Link struct with link type constants per prd007\n- Stash and StashHistoryEntry structs per prd008\n- All entity-specific sentinel errors from prd001 R7.3\n\n## Design Decisions\n- Keep entity errors centralized in errors.go for discoverability\n- Property methods on Crumb do basic checks (key exists in map); full validation deferred to Table.Set\n- Trail.Complete requires active state; Trail.Abandon requires active state per prd006\n\n## Acceptance Criteria\n- [ ] Crumb property methods compile and modify Properties map\n- [ ] Trail struct with lifecycle methods compiles\n- [ ] Property, Category, Metadata, Link, Stash structs all compile with correct fields\n- [ ] All entity-specific errors defined\n- [ ] go build ./pkg/types succeeds","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:18:35.858479-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:18:35.858479-05:00","dependencies":[{"issue_id":"generation-2026-02-12-07-13-55-eow","depends_on_id":"generation-2026-02-12-07-13-55-g72","type":"blocks","created_at":"2026-02-12T07:18:37.012621-05:00","created_by":"petardjukic"}]}
{"id":"generation-2026-02-12-07-13-55-g72","title":"Define Crumb entity struct and state transition methods in pkg/types","description":"## Required Reading\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (R1, R2, R4)\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (R7.3 for entity method errors)\n- pkg/types/table.go (error types already defined)\n\n## Files to Create/Modify\n- pkg/types/crumb.go (create) - Crumb struct, state constants, state transition methods\n\n## Requirements\n- Crumb struct: CrumbID (string), Name (string), State (string), CreatedAt (time.Time), UpdatedAt (time.Time), Properties (map[string]any)\n- State constants: draft, pending, ready, taken, pebble, dust\n- Valid states set for validation\n- SetState(state string) error: validates state is valid, updates State and UpdatedAt; idempotent; returns ErrInvalidState for invalid state\n- Pebble() error: requires current state is \"taken\", sets State to pebble, updates UpdatedAt; returns ErrInvalidTransition otherwise\n- Dust() error: sets State to dust from any state, updates UpdatedAt; idempotent\n\n## Design Decisions\n- State as string (not Go enum) for JSON compatibility per prd003 R2.4\n- Entity methods modify struct in memory; caller calls Table.Set to persist\n- Use a validStates map for O(1) lookup\n\n## Acceptance Criteria\n- [ ] Crumb struct has all 6 fields per prd003 R1.1\n- [ ] 6 state constants defined\n- [ ] SetState validates and transitions correctly\n- [ ] Pebble requires \"taken\" state, returns ErrInvalidTransition otherwise\n- [ ] Dust works from any state, is idempotent\n- [ ] All methods update UpdatedAt\n- [ ] go build ./pkg/types succeeds","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:18:35.726714-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:18:35.726714-05:00","dependencies":[{"issue_id":"generation-2026-02-12-07-13-55-g72","depends_on_id":"generation-2026-02-12-07-13-55-57l","type":"blocks","created_at":"2026-02-12T07:18:36.913338-05:00","created_by":"petardjukic"}]}
{"id":"generation-2026-02-12-07-13-55-ny9","title":"Implement trails, links, and properties table accessors","description":"## Required Reading\n- docs/specs/product-requirements/prd002-sqlite-backend.yaml (R5.5-R5.7 trail cascade, R12 table routing)\n- docs/specs/product-requirements/prd006-trails-interface.yaml (Trail entity)\n- docs/specs/product-requirements/prd007-links-interface.yaml (Link entity, types, uniqueness)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (Property, Category entities)\n- internal/sqlite/crumbs_table.go (existing pattern)\n- internal/sqlite/jsonl.go (JSONL helpers)\n\n## Files to Create/Modify\n- internal/sqlite/trails_table.go (create) - trailsTable implementing Table; Get, Set (with cascade on state change: completed removes belongs_to links, abandoned cascades crumb deletion), Delete, Fetch\n- internal/sqlite/links_table.go (create) - linksTable implementing Table; Get, Set (validate uniqueness constraint link_type+from_id+to_id), Delete, Fetch (filter by link_type, from_id, to_id)\n- internal/sqlite/properties_table.go (create) - propertiesTable implementing Table; Get, Set (with backfill: creating property seeds defaults for all existing crumbs), Delete, Fetch\n\n## Requirements\n- trailsTable: hydrate/dehydrate Trail per prd002 R14.3; Set detects state change to completed (remove belongs_to links) or abandoned (cascade delete crumbs + their properties/metadata/links) per prd002 R5.6-R5.7\n- linksTable: hydrate/dehydrate Link per prd002 R14.6; Set validates uniqueness of (link_type, from_id, to_id); Fetch supports filter by link_type, from_id, to_id\n- propertiesTable: hydrate/dehydrate Property per prd002 R14.4; Set triggers backfill of crumb_properties for all existing crumbs when creating a new property\n- Each table persists to its JSONL file atomically\n\n## Design Decisions\n- Trail cascade runs inside the same SQLite transaction as the state update\n- Link uniqueness enforced at SQL level (UNIQUE constraint) and returned as appropriate error\n- Property backfill queries all crumbs and inserts default property values\n\n## Acceptance Criteria\n- [ ] trailsTable implements Table; cascade on completed/abandoned works\n- [ ] linksTable implements Table; uniqueness enforced\n- [ ] propertiesTable implements Table; backfill on creation works\n- [ ] All tables persist to JSONL atomically\n- [ ] go build ./internal/sqlite succeeds","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:18:36.260855-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:18:36.260855-05:00","dependencies":[{"issue_id":"generation-2026-02-12-07-13-55-ny9","depends_on_id":"generation-2026-02-12-07-13-55-a1t","type":"blocks","created_at":"2026-02-12T07:18:37.306381-05:00","created_by":"petardjukic"}]}
{"id":"generation-2026-02-12-07-13-55-xxi","title":"Integration tests for SQLite backend: Cupboard lifecycle and crumbs CRUD","description":"## Required Reading\n- docs/specs/test-suites/test-rel01.0-uc001-cupboard-lifecycle.yaml (all test cases)\n- docs/specs/test-suites/test-rel01.0-uc002-table-crud.yaml (all test cases)\n- docs/specs/test-suites/test-rel01.0-uc003-crumb-lifecycle.yaml (all test cases)\n- internal/sqlite/backend.go (SQLiteBackend)\n- internal/sqlite/crumbs_table.go (crumbsTable)\n\n## Files to Create/Modify\n- tests/integration/test_rel01_0_uc001_cupboard_lifecycle_test.go (create) - Table-driven tests: Attach with valid config, Attach with invalid config, Detach idempotent, GetTable for all standard names, GetTable for unknown name, operations after Detach return ErrCupboardDetached\n- tests/integration/test_rel01_0_uc002_table_crud_test.go (create) - Table-driven tests: Set creates crumb with UUID v7, Get retrieves by ID, Get returns ErrNotFound, Delete removes crumb, Delete cascades, Fetch with empty filter, Fetch with state filter, Fetch with limit/offset, JSONL persistence after Set/Delete\n- tests/integration/test_rel01_0_uc003_crumb_lifecycle_test.go (create) - Table-driven tests: create draft crumb, transition through states, Pebble from taken, Pebble from non-taken fails, Dust from any state, persist and reload state\n\n## Requirements\n- Use t.TempDir() for DataDir isolation\n- Each test creates a fresh SQLiteBackend, Attaches, runs test cases, Detaches\n- Verify JSONL files are written correctly (read back and parse)\n- Test JSONL roundtrip: Attach, write data, Detach, delete cupboard.db, re-Attach, verify data loaded from JSONL\n- Use testify for assertions\n\n## Design Decisions\n- Integration tests in tests/integration/ per project layout\n- Each test suite file maps to one use case YAML\n- Table-driven tests with shared setup/teardown\n\n## Acceptance Criteria\n- [ ] Cupboard lifecycle tests cover attach/detach/error paths\n- [ ] CRUD tests cover all Table operations\n- [ ] Crumb lifecycle tests cover state machine\n- [ ] JSONL roundtrip test verifies data survives db deletion\n- [ ] All tests pass: go test ./tests/integration/...","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:18:36.681468-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:18:36.681468-05:00","dependencies":[{"issue_id":"generation-2026-02-12-07-13-55-xxi","depends_on_id":"generation-2026-02-12-07-13-55-6dx","type":"blocks","created_at":"2026-02-12T07:18:37.614696-05:00","created_by":"petardjukic"}]}
