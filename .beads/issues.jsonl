{"id":"generation-2026-02-11-21-24-06-5q4","title":"Define Config struct, Cupboard interface, Table interface, and standard errors in pkg/types","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Config, Cupboard, Table, errors, UUID v7)\n- docs/ARCHITECTURE.md ยง System Overview (ORM-style pattern, entity types, table names)\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml ยง R1 (Crumb struct fields for entity method errors)\n\n## Files to Create/Modify\n- pkg/types/config.go (create) - Config struct, config validation errors (ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid), Validate method\n- pkg/types/cupboard.go (create) - Cupboard interface (GetTable, Attach, Detach), cupboard lifecycle errors (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound), standard table name constants\n- pkg/types/table.go (create) - Table interface (Get, Set, Delete, Fetch), table operation errors (ErrNotFound, ErrInvalidID, ErrInvalidData), entity method errors (ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter)\n- pkg/types/config_test.go (create) - Tests for Config.Validate (empty backend, unknown backend, empty DataDir, valid config)\n\n## Requirements\n- Define Config struct per prd001 R1: Backend (string), DataDir (string)\n- Define Config.Validate() method per prd001 R1.2, R1.3: fail on empty/unknown Backend, fail on empty DataDir when Backend is \"sqlite\"\n- Define Cupboard interface per prd001 R2.2: GetTable(name string) (Table, error), Attach(config Config) error, Detach() error\n- Define Table interface per prd001 R3.1: Get(id string) (any, error), Set(id string, data any) (string, error), Delete(id string) error, Fetch(filter map[string]any) ([]any, error)\n- Define standard table name constants per prd001 R2.5: \"crumbs\", \"trails\", \"properties\", \"metadata\", \"links\", \"stashes\"\n- Define all sentinel errors per prd001 R7.1 (config errors), R7.2 (cupboard lifecycle errors), R7.3 (table operation errors), R7.4 (entity method errors)\n- All errors must work with errors.Is\n\n## Design Decisions\n- Place interfaces and types in pkg/types/ (not pkg/crumbs/) per Go layout in go-style rule\n- Config struct lives in config.go with its validation errors; Cupboard interface in cupboard.go with lifecycle errors; Table interface in table.go with operation errors\n- Table name constants are string constants (e.g. TableCrumbs = \"crumbs\") in cupboard.go\n- Do NOT define entity structs (Crumb, Trail, etc.) in this task - those are separate tasks per their respective PRDs\n- Do NOT implement Cupboard or Table - only define the interfaces\n\n## Acceptance Criteria\n- [ ] Config struct has Backend and DataDir fields\n- [ ] Config.Validate() returns ErrBackendEmpty for empty Backend\n- [ ] Config.Validate() returns ErrBackendUnknown for unrecognized Backend\n- [ ] Config.Validate() returns ErrSyncStrategyUnknown for unrecognized SyncStrategy (if present)\n- [ ] Config.Validate() returns nil for valid config\n- [ ] Cupboard interface has GetTable, Attach, Detach methods with correct signatures\n- [ ] Table interface has Get, Set (returning string, error), Delete, Fetch with correct signatures\n- [ ] All 5 config errors defined as sentinel errors in config.go\n- [ ] All 3 cupboard lifecycle errors defined as sentinel errors in cupboard.go\n- [ ] All 3 table operation errors and 13 entity method errors defined as sentinel errors in table.go\n- [ ] 6 standard table name constants defined\n- [ ] Unit tests for Config.Validate pass\n- [ ] go build ./... succeeds\n- [ ] go vet ./... passes","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T21:27:22.93353-05:00","created_by":"petardjukic","updated_at":"2026-02-11T21:29:19.515887-05:00","closed_at":"2026-02-11T21:29:19.515887-05:00","close_reason":"Closed"}
