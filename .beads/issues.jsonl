{"id":"generation-2026-02-12-07-00-17-oga","title":"Define shared types and interfaces in pkg/types","description":"## Required Reading\n- docs/ARCHITECTURE.md (System Overview, Main Interfaces, Entity Types)\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Config R1, Cupboard R2, Table R3, Errors R7, UUID R8)\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (R1: Crumb struct, R2: state values)\n- docs/specs/product-requirements/prd006-trails-interface.yaml (R1: Trail struct, R2: state values)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (R1: Property struct, R2: Category struct, R3: value types)\n- docs/specs/product-requirements/prd005-metadata-interface.yaml (R1: Metadata struct)\n- docs/specs/product-requirements/prd007-links-interface.yaml (R1: Link struct, R2: link types)\n- docs/specs/product-requirements/prd008-stash-interface.yaml (R1: Stash struct, R2: stash types)\n- docs/specs/use-cases/rel01.0-uc004-scaffolding-validation.yaml (success criteria S5-S9)\n- docs/specs/test-suites/test-rel01.0-uc004-scaffolding-validation.yaml\n\n## Files to Create/Modify\n- pkg/types/config.go (create) - Config struct, config validation errors\n- pkg/types/cupboard.go (create) - Cupboard interface, cupboard lifecycle errors\n- pkg/types/table.go (create) - Table interface, table name constants, table operation errors, entity method errors\n- pkg/types/crumb.go (create) - Crumb struct, crumb state constants, entity methods (SetState, Pebble, Dust, SetProperty, GetProperty, GetProperties, ClearProperty)\n- pkg/types/trail.go (create) - Trail struct, trail state constants, entity methods (Complete, Abandon)\n- pkg/types/property.go (create) - Property struct, Category struct, value type constants\n- pkg/types/metadata.go (create) - Metadata struct\n- pkg/types/link.go (create) - Link struct, link type constants\n- pkg/types/stash.go (create) - Stash struct, stash type constants\n\n## Requirements\n1. Config struct with Backend (string) and DataDir (string) fields per prd001 R1.1\n2. Config validation errors: ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid per prd001 R1.4\n3. Cupboard interface with GetTable(name string) (Table, error), Attach(config Config) error, Detach() error per prd001 R2.2\n4. Table interface with Get(id string) (any, error), Set(id string, data any) (string, error), Delete(id string) error, Fetch(filter map[string]any) ([]any, error) per prd001 R3.1\n5. Standard table name constants: CrumbsTable, TrailsTable, PropertiesTable, CategoriesTable, MetadataTable, LinksTable, StashesTable per prd001 R2.5\n6. Cupboard lifecycle errors: ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound per prd001 R7.1\n7. Table operation errors: ErrNotFound, ErrInvalidID, ErrInvalidData per prd001 R7.2\n8. Entity method errors: ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter per prd001 R7.3\n9. Crumb struct: CrumbID, Name, State, CreatedAt, UpdatedAt, Properties per prd003 R1.1\n10. Crumb state constants: StateDraft, StatePending, StateReady, StateTaken, StatePebble, StateDust per prd003 R2.1\n11. Crumb entity methods: SetState, Pebble, Dust, SetProperty, GetProperty, GetProperties, ClearProperty per prd003 R4, R5\n12. Trail struct: TrailID, State, CreatedAt, CompletedAt per prd006 R1.1\n13. Trail state constants: TrailStateDraft, TrailStatePending, TrailStateActive, TrailStateCompleted, TrailStateAbandoned per prd006 R2.1\n14. Trail entity methods: Complete, Abandon per prd006 R3\n15. Property struct: PropertyID, Name, Description, ValueType, CreatedAt per prd004 R1.1\n16. Category struct: CategoryID, PropertyID, Name, Ordinal per prd004 R2.1\n17. Metadata struct: MetadataID, CrumbID, TableName, Content, PropertyID, CreatedAt per prd005 R1.1\n18. Link struct: LinkID, LinkType, FromID, ToID, CreatedAt per prd007 R1.1\n19. Link type constants: LinkBelongsTo, LinkChildOf, LinkBranchesFrom, LinkScopedTo per prd007 R2\n20. Stash struct: StashID, Name, StashType, Value, Version, CreatedAt, LastOperation, ChangedBy per prd008 R1.1\n\n## Design Decisions\n- All types go in pkg/types/ (shared contract layer, importable by backends and CLI)\n- Entity methods modify structs in memory; callers persist via Table.Set (ORM pattern from ARCHITECTURE)\n- State constants are string consts, not enums, for JSON compatibility\n- Errors are sentinel errors using errors.New, compatible with errors.Is\n- No implementation code in pkg/types/ - only types, interfaces, constants, entity methods, and errors\n\n## Acceptance Criteria\n- [ ] go build ./cmd/cupboard succeeds (all types compile)\n- [ ] go build ./pkg/types/ succeeds\n- [ ] Config struct has Backend and DataDir fields\n- [ ] Cupboard interface defines GetTable, Attach, Detach\n- [ ] Table interface defines Get, Set (returning string, error), Delete, Fetch\n- [ ] All 7 entity structs defined with fields matching their PRDs\n- [ ] Standard table name constants defined for all tables\n- [ ] All error sentinels from prd001 R7 defined\n- [ ] Crumb entity methods (SetState, Pebble, Dust, SetProperty, GetProperty, GetProperties, ClearProperty) implemented with validation\n- [ ] Trail entity methods (Complete, Abandon) implemented with validation\n- [ ] go vet ./pkg/types/ passes","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-12T07:03:03.723144-05:00","created_by":"petardjukic","updated_at":"2026-02-12T07:06:44.928129-05:00","closed_at":"2026-02-12T07:06:44.928129-05:00","close_reason":"Closed"}
