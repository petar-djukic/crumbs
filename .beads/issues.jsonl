{"id":"generation-2026-02-11-21-52-21-4a8","title":"Add Crumb entity methods and tests","description":"## Required Reading\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (R4 state transitions, R5 property methods)\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (R7 error types)\n- docs/specs/test-suites/test-rel01.0-uc003-crumb-lifecycle.yaml (test cases for state machine)\n- pkg/types/crumb.go (Crumb struct from task 0)\n- pkg/types/errors.go (sentinel errors from task 0)\n\n## Files to Create/Modify\n- pkg/types/crumb.go (modify) - Add SetState, Pebble, Dust, SetProperty, GetProperty, GetProperties, ClearProperty methods\n- pkg/types/crumb_test.go (create) - Tests for all entity methods\n\n## Requirements\n- Implement SetState(state string) error per prd003 R4.2: validate state is one of the valid states (return ErrInvalidState if not), update State field, update UpdatedAt, idempotent for current state\n- Implement Pebble() error per prd003 R4.3: validate current state is taken (return ErrInvalidTransition if not), set State to pebble, update UpdatedAt\n- Implement Dust() error per prd003 R4.4: callable from any state, set State to dust, update UpdatedAt, idempotent\n- Implement SetProperty(propertyID string, value any) error per prd003 R5.2: set value in Properties map, update UpdatedAt. Validation of property existence and type deferred to Table.Set per R5.7\n- Implement GetProperty(propertyID string) (any, error) per prd003 R5.3: return value from Properties map, return ErrPropertyNotFound if not present\n- Implement GetProperties() map[string]any per prd003 R5.4: return the Properties map\n- Implement ClearProperty(propertyID string) error per prd003 R5.5: set property to zero value in Properties map (empty string for text, 0 for integer, nil for categorical, empty slice for list), return ErrPropertyNotFound if not present, update UpdatedAt. Note: full type-aware default lookup deferred to Table.Set\n- Add NewCrumb(name string) helper that creates a Crumb with State=draft, CreatedAt=now, UpdatedAt=now, empty Properties map\n\n## Design Decisions\n- Entity methods are pure struct operations (no database access). They modify fields in memory; caller calls Table.Set to persist per prd003 R4.5\n- Property validation (existence check against property definitions, type matching) is deferred to Table.Set per prd003 R5.7. SetProperty on the struct is a simple map write with UpdatedAt update\n- ClearProperty sets a zero value (not delete) since properties are never unset per prd003 R5.5. Without access to property definitions, use Go zero values as defaults\n- Tests use table-driven pattern per go-style rule\n\n## Acceptance Criteria\n- [ ] SetState validates state values and returns ErrInvalidState for invalid states\n- [ ] SetState is idempotent for current state\n- [ ] Pebble returns ErrInvalidTransition when state is not taken\n- [ ] Pebble succeeds when state is taken\n- [ ] Dust succeeds from any state and is idempotent\n- [ ] All state methods update UpdatedAt\n- [ ] SetProperty writes to Properties map and updates UpdatedAt\n- [ ] GetProperty returns ErrPropertyNotFound for missing property\n- [ ] GetProperties returns the Properties map\n- [ ] ClearProperty sets zero value and returns ErrPropertyNotFound for missing property\n- [ ] NewCrumb creates a correctly initialized Crumb\n- [ ] All tests pass: go test ./pkg/types/...\n- [ ] go vet ./... passes","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T21:55:11.020673-05:00","created_by":"petardjukic","updated_at":"2026-02-11T21:55:11.020673-05:00","dependencies":[{"issue_id":"generation-2026-02-11-21-52-21-4a8","depends_on_id":"generation-2026-02-11-21-52-21-rfg","type":"blocks","created_at":"2026-02-11T21:55:11.120943-05:00","created_by":"petardjukic"}]}
{"id":"generation-2026-02-11-21-52-21-rfg","title":"Define shared types, interfaces, and error sentinels in pkg/types","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Config, Cupboard, Table interfaces, standard table names, error types)\n- docs/specs/product-requirements/prd002-sqlite-backend.yaml (entity hydration mappings R14 for struct field names)\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (Crumb struct R1, state values R2, filter map R9)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (Property and Category structs)\n- docs/specs/product-requirements/prd005-metadata-interface.yaml (Metadata struct)\n- docs/specs/product-requirements/prd006-trails-interface.yaml (Trail struct)\n- docs/specs/product-requirements/prd007-links-interface.yaml (Link struct)\n- docs/specs/product-requirements/prd008-stash-interface.yaml (Stash struct)\n- docs/ARCHITECTURE.md ยง Main Interfaces, ยง System Components\n\n## Files to Create/Modify\n- pkg/types/config.go (create) - Config struct with Backend and DataDir fields, config validation errors (ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid), Validate() method\n- pkg/types/cupboard.go (create) - Cupboard interface (GetTable, Attach, Detach), Table interface (Get, Set, Delete, Fetch), standard table name constants, cupboard lifecycle errors (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound)\n- pkg/types/errors.go (create) - Table operation errors (ErrNotFound, ErrInvalidID, ErrInvalidData) and entity method errors (ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter)\n- pkg/types/crumb.go (create) - Crumb struct with CrumbID, Name, State, CreatedAt, UpdatedAt, Properties fields; state constants (StateDraft, StatePending, StateReady, StateTaken, StatePebble, StateDust); Filter type alias\n- pkg/types/trail.go (create) - Trail struct with TrailID, State, CreatedAt, CompletedAt fields; trail state constants\n- pkg/types/property.go (create) - Property struct with PropertyID, Name, Description, ValueType, CreatedAt fields; Category struct with CategoryID, PropertyID, Name, Ordinal fields; value type constants\n- pkg/types/metadata.go (create) - Metadata struct with MetadataID, TableName, CrumbID, PropertyID, Content, CreatedAt fields\n- pkg/types/link.go (create) - Link struct with LinkID, LinkType, FromID, ToID, CreatedAt fields; link type constants\n- pkg/types/stash.go (create) - Stash struct with StashID, Name, StashType, Value, Version, CreatedAt, UpdatedAt fields; stash type constants\n\n## Requirements\n- Define all entity structs exactly matching the hydration mappings in prd002-sqlite-backend R14\n- Define Config struct per prd001 R1 with Validate() method\n- Define Cupboard interface per prd001 R2 (GetTable, Attach, Detach)\n- Define Table interface per prd001 R3 (Get, Set returning (string, error), Delete, Fetch)\n- Define all sentinel errors from prd001 R7 (split across config.go, cupboard.go, errors.go)\n- Define standard table name constants per prd001 R2.5 (crumbs, trails, properties, metadata, links, stashes)\n- Define state constants for Crumb (draft, pending, ready, taken, pebble, dust) and Trail (draft, pending, active, completed, abandoned)\n- Define link type constants (belongs_to, child_of, branches_from, scoped_to)\n- Define value type constants for properties (categorical, text, integer, boolean, timestamp, list)\n- Define stash type constants (resource, artifact, context, counter, lock)\n- Define Filter type alias (map[string]any) per prd003 R9\n- Use JSON struct tags matching JSONL field names from prd002 R2 (e.g., crumb_id, not CrumbID)\n- Use time.Time for timestamps, *time.Time for nullable timestamps (CompletedAt)\n- Package doc comment listing implemented PRDs\n\n## Design Decisions\n- All types in pkg/types/ (shared public API, no implementation)\n- No methods on entity structs in this task (entity methods are a separate task)\n- Errors split by concern: config errors in config.go, cupboard lifecycle errors in cupboard.go, all table/entity operation errors in errors.go\n- Use const blocks for state, link type, value type, and stash type constants\n- Stash.Value typed as any (JSON-decoded value per prd002 R14.7)\n\n## Acceptance Criteria\n- [ ] All entity structs compile and match PRD field definitions\n- [ ] Config.Validate() returns correct errors for empty backend, unknown backend, empty DataDir\n- [ ] Cupboard and Table interfaces compile\n- [ ] All sentinel errors defined and checkable with errors.Is\n- [ ] Standard table name constants defined\n- [ ] JSON struct tags match JSONL field names from prd002 R2\n- [ ] go build ./... succeeds\n- [ ] Package doc comment references implemented PRDs","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T21:55:10.884332-05:00","created_by":"petardjukic","updated_at":"2026-02-11T22:00:07.257021-05:00","closed_at":"2026-02-11T22:00:07.257021-05:00","close_reason":"Closed"}
