{"id":"generation-2026-02-11-19-17-rv3","title":"Define core types, interfaces, and entity structs in pkg/types","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Config, Cupboard interface, Table interface, standard table names, error types, UUID v7 requirement)\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (Crumb struct fields R1, state values R2, Filter type alias R9)\n- docs/specs/product-requirements/prd002-sqlite-backend.yaml (Link struct and link types from graph_model section, R2.6 links format)\n- docs/specs/product-requirements/prd006-trails-interface.yaml (Trail struct fields, state values)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (Property struct, Category struct, value types)\n- docs/specs/product-requirements/prd005-metadata-interface.yaml (Metadata struct fields, schema names)\n- docs/specs/product-requirements/prd008-stash-interface.yaml (Stash struct fields, stash types)\n- docs/ARCHITECTURE.md § Main Interfaces, § System Components\n- docs/specs/use-cases/rel01.0-uc004-scaffolding-validation.yaml (success criteria S5-S9 define what must compile)\n\n## Files to Create/Modify\n- pkg/types/config.go (create) — Config struct, config validation errors (ErrBackendEmpty, ErrBackendUnknown, etc.), Config.Validate() method\n- pkg/types/cupboard.go (create) — Cupboard interface (GetTable, Attach, Detach), cupboard lifecycle errors (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound)\n- pkg/types/table.go (create) — Table interface (Get, Set, Delete, Fetch), table operation errors (ErrNotFound, ErrInvalidID, ErrInvalidData), entity method errors (ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter), Filter type alias\n- pkg/types/tables.go (create) — Standard table name constants (CrumbsTable, TrailsTable, PropertiesTable, MetadataTable, LinksTable, StashesTable), AllTables slice\n- pkg/types/crumb.go (create) — Crumb struct with fields (CrumbID, Name, State, CreatedAt, UpdatedAt, Properties), state constants (StateDraft through StateDust), state transition methods (SetState, Pebble, Dust), property methods (SetProperty, GetProperty, GetProperties, ClearProperty)\n- pkg/types/trail.go (create) — Trail struct with fields (TrailID, State, CreatedAt, CompletedAt), trail state constants, Complete and Abandon methods\n- pkg/types/property.go (create) — Property struct (PropertyID, Name, Description, ValueType, CreatedAt), Category struct (CategoryID, PropertyID, Name, Ordinal), value type constants\n- pkg/types/metadata.go (create) — Metadata struct (MetadataID, CrumbID, TableName, Content, PropertyID, CreatedAt), schema name constants\n- pkg/types/link.go (create) — Link struct (LinkID, LinkType, FromID, ToID, CreatedAt), link type constants (LinkBelongsTo, LinkChildOf, LinkBranchesFrom, LinkScopedTo)\n- pkg/types/stash.go (create) — Stash struct (StashID, Name, StashType, Value, Version, CreatedAt, LastOperation, ChangedBy), stash type constants\n- pkg/types/doc.go (create) — Package documentation referencing implemented PRDs\n\n## Requirements\n- Define all types and interfaces exactly as specified in prd001-cupboard-core R1-R3, R7-R8\n- Define all seven entity structs with fields matching their respective PRDs\n- Define all standard error types as sentinel errors (errors.New)\n- Define all constants (table names, states, link types, value types, stash types)\n- Crumb entity methods (SetState, Pebble, Dust) must implement validation per prd003 R4\n- Crumb property methods (SetProperty, GetProperty, GetProperties, ClearProperty) must be defined per prd003 R5 (validation may be deferred to Table.Set per R5.7)\n- Trail entity methods (Complete, Abandon) must be defined per prd006\n- Config.Validate() must enforce R1.2 and R1.3 from prd001\n- Filter type alias: type Filter = map[string]any\n- No implementation code (no SQLite, no JSONL). Only types, interfaces, constants, errors, and entity methods that operate on struct fields in memory\n\n## Design Decisions\n- All types live in pkg/types/ (shared public API per go-style rule)\n- Entity methods modify struct fields in memory; persistence is the caller's responsibility via Table.Set\n- Property method validation (SetProperty type checking) is deferred — methods update the map without checking property definitions. Validation happens at Table.Set time in the backend\n- Use google/uuid for UUID v7 generation (already in go.mod ecosystem packages)\n- State values are string constants, not enums, for JSON compatibility\n- All errors are package-level var with errors.New per prd001 R7\n\n## Acceptance Criteria\n- [ ] go build ./cmd/cupboard compiles without errors (transitively compiles all pkg/types)\n- [ ] go vet ./... passes\n- [ ] Config struct has Backend and DataDir fields; Config.Validate() returns correct errors\n- [ ] Cupboard interface has GetTable, Attach, Detach methods with correct signatures\n- [ ] Table interface has Get(string)(any,error), Set(string,any)(string,error), Delete(string)error, Fetch(map[string]any)([]any,error)\n- [ ] All 6 standard table name constants defined\n- [ ] All 7 entity structs defined with documented fields\n- [ ] Crumb.SetState validates state values; Crumb.Pebble validates current state is taken; Crumb.Dust works from any state\n- [ ] Trail.Complete and Trail.Abandon methods exist with state validation\n- [ ] All sentinel errors from prd001 R7.1, R7.2, R7.3 are defined\n- [ ] Filter type alias defined\n- [ ] Package doc references implemented PRDs","status":"open","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T19:20:12.867302-05:00","created_by":"petardjukic","updated_at":"2026-02-11T19:20:12.867302-05:00"}
