{"id":"crumbs-gfu","title":"Interface Definition PRDs","description":"Define Cupboard interface PRDs using table accessor pattern. Each PRD specifies one table interface from prd-cupboard-core.\n\n## Scope (revised)\n\nSix PRDs total:\n1. prd-cupboard-core - Cupboard lifecycle, config, table accessors (DONE)\n2. prd-sqlite-backend - SQLite backend, JSON sync, graph model, LinkTable (DONE)\n3. prd-crumbs-interface - CrumbTable: Drop, Get, Delete, Fetch, property ops\n4. prd-trails-interface - TrailTable: Start, Get, GetCrumbs, Complete, Abandon\n5. prd-properties-interface - PropertyTable: Define, Get, List, DefineCategory\n6. prd-metadata-interface - MetadataTable: Register, Add, Get, Search\n\n## Design Decisions\n\n- Table accessor pattern: cupboard.Crumbs(), cupboard.Trails(), etc.\n- Graph model: links table for belongs_to (crumb→trail) and child_of (crumb→crumb)\n- Property values on CrumbTable (not separate interface)\n- FetchCrumbs on CrumbTable (not separate query interface)\n- LinkTable defined in prd-sqlite-backend (graph model)\n\n## Removed from original scope\n\n- prd-crumb-properties-interface (merged into CrumbTable)\n- prd-query-interface (FetchCrumbs merged into CrumbTable)\n\n## Acceptance Criteria\n\n- [ ] All six PRDs created in docs/product-requirements/\n- [ ] Each PRD follows prd-format\n- [ ] Each PRD defines Go interface matching prd-cupboard-core\n- [ ] PRDs traceable to prd-task-storage requirements","status":"open","priority":2,"issue_type":"epic","created_at":"2026-02-03T21:04:45.137607-05:00","created_by":"petardjukic","updated_at":"2026-02-04T10:13:45.870459-05:00"}
{"id":"crumbs-gfu.1","title":"PRD: Cupboard Core Interface","description":"## Type\nDocumentation\n\n## Output Path\ndocs/product-requirements/prd-cupboard-core.md\n\n## Required Sections (per prd-format)\n1. Problem - Why we need a cupboard lifecycle interface\n2. Goals - Define the core cupboard contract\n3. Requirements - Go interface definition, Config struct, OpenCupboard, CloseCupboard, backend selection, error conditions\n4. Non-Goals - Implementation details, specific backend behavior\n5. Acceptance Criteria - Interface defined, config schema, error handling\n\n## Scope\n- Config struct with backend selection, backend-specific parameters\n- OpenCupboard(config) returns Cupboard instance\n- CloseCupboard() releases resources, idempotent\n- Error handling for operations after close\n- Backend interface that all backends must implement\n\n## Design Decisions\n- Config uses functional options or struct with backend-specific embedded configs\n- Cupboard interface is the main contract; backends implement it\n- Reference prd-task-storage R8, R9\n\n## Acceptance Criteria\n- [ ] PRD saved at docs/product-requirements/prd-cupboard-core.md\n- [ ] Defines Config struct with all fields\n- [ ] Defines Cupboard interface with OpenCupboard, CloseCupboard\n- [ ] Defines Backend interface\n- [ ] Documents error conditions\n- [ ] Follows prd-format","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-03T21:05:00.164888-05:00","created_by":"petardjukic","updated_at":"2026-02-03T21:07:49.837711-05:00","closed_at":"2026-02-03T21:07:49.837711-05:00","close_reason":"Closed","dependencies":[{"issue_id":"crumbs-gfu.1","depends_on_id":"crumbs-gfu","type":"parent-child","created_at":"2026-02-03T21:05:00.167338-05:00","created_by":"petardjukic"}],"comments":[{"id":1,"issue_id":"crumbs-gfu.1","author":"petardjukic","text":"tokens: 45000, loc: 162+0","created_at":"2026-02-04T02:07:44Z"}]}
{"id":"crumbs-gfu.2","title":"PRD: Crumbs Interface","description":"## Type\nDocumentation\n\n## Output Path\ndocs/product-requirements/prd-crumbs-interface.md\n\n## Required Sections (per prd-format)\n1. Problem - Core entity storage for work items\n2. Goals - Define CrumbTable interface\n3. Requirements - Crumb struct, Drop, Get, Delete, Fetch, property operations\n4. Non-Goals - Trail operations, property definitions (separate interfaces)\n5. Acceptance Criteria - Interface defined, struct documented\n\n## Scope (updated for table accessor pattern)\n- Crumb struct: crumb_id, name, state, created_at, updated_at (no trail_id - uses links)\n- CrumbTable interface from prd-cupboard-core:\n  - Drop(name) - create crumb with UUID v7\n  - Get(id) - retrieve by ID\n  - Delete(id) - remove crumb and associated data\n  - Fetch(filter) - query crumbs by properties\n  - SetProperty, GetProperty, GetProperties, ClearProperty - property values\n- State values: pending, ready, running, completed, failed\n- Filter struct for Fetch operation\n\n## Design Decisions\n- Trail membership via links table (belongs_to), not crumb field\n- Property operations on CrumbTable (not separate interface)\n- Fetch replaces separate query interface\n- Reference prd-cupboard-core R2.3\n\n## Acceptance Criteria\n- [ ] PRD saved at docs/product-requirements/prd-crumbs-interface.md\n- [ ] Defines Crumb struct (no trail_id field)\n- [ ] Defines CrumbTable interface matching prd-cupboard-core\n- [ ] Defines Filter struct for Fetch\n- [ ] Documents state values\n- [ ] Follows prd-format","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-03T21:05:07.136442-05:00","created_by":"petardjukic","updated_at":"2026-02-04T10:12:49.304093-05:00","dependencies":[{"issue_id":"crumbs-gfu.2","depends_on_id":"crumbs-gfu","type":"parent-child","created_at":"2026-02-03T21:05:07.14021-05:00","created_by":"petardjukic"}]}
{"id":"crumbs-gfu.3","title":"PRD: Trails Interface","description":"## Type\nDocumentation\n\n## Output Path\ndocs/product-requirements/prd-trails-interface.md\n\n## Required Sections (per prd-format)\n1. Problem - Support exploratory work sessions with backtracking\n2. Goals - Define TrailTable interface\n3. Requirements - Trail struct, Start, Get, GetCrumbs, Complete, Abandon\n4. Non-Goals - Crumb CRUD (separate interface), link operations (prd-sqlite-backend)\n5. Acceptance Criteria - Interface defined, lifecycle documented\n\n## Scope (updated for table accessor pattern)\n- Trail struct: trail_id, parent_crumb_id, state, created_at, completed_at\n- TrailTable interface from prd-cupboard-core:\n  - Start(parentCrumbID?) - create trail, optionally deviate from crumb\n  - Get(id) - retrieve trail\n  - GetCrumbs(id) - list crumbs on trail (via belongs_to links)\n  - Complete(id) - mark completed, remove belongs_to links (crumbs become permanent)\n  - Abandon(id) - mark abandoned, delete crumbs and their links\n- Trail states: active, completed, abandoned\n\n## Design Decisions\n- Crumb membership via links table (belongs_to), queried by GetCrumbs\n- Complete removes belongs_to links (crumbs no longer belong to any trail)\n- Abandon deletes crumbs and all their links\n- Reference prd-cupboard-core R2.3, prd-sqlite-backend graph model\n\n## Acceptance Criteria\n- [ ] PRD saved at docs/product-requirements/prd-trails-interface.md\n- [ ] Defines Trail struct\n- [ ] Defines TrailTable interface matching prd-cupboard-core\n- [ ] Documents complete vs abandon semantics with links\n- [ ] Documents trail states\n- [ ] Follows prd-format","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-03T21:05:12.659552-05:00","created_by":"petardjukic","updated_at":"2026-02-04T10:13:03.467712-05:00","dependencies":[{"issue_id":"crumbs-gfu.3","depends_on_id":"crumbs-gfu","type":"parent-child","created_at":"2026-02-03T21:05:12.661217-05:00","created_by":"petardjukic"}]}
{"id":"crumbs-gfu.4","title":"PRD: Properties Interface","description":"## Type\nDocumentation\n\n## Output Path\ndocs/product-requirements/prd-properties-interface.md\n\n## Required Sections (per prd-format)\n1. Problem - Extensible property definitions without schema migrations\n2. Goals - Define PropertyTable interface\n3. Requirements - Property struct, Category struct, Define, Get, List, DefineCategory\n4. Non-Goals - Setting property values on crumbs (in CrumbTable)\n5. Acceptance Criteria - Interface defined, built-in properties listed\n\n## Scope (updated for table accessor pattern)\n- Property struct: property_id, name, description, value_type, created_at\n- Category struct: category_id, property_id, name, ordinal\n- PropertyTable interface from prd-cupboard-core:\n  - Define(name, description, valueType) - create property definition\n  - Get(id) - retrieve definition\n  - List() - list all definitions\n  - DefineCategory(propertyID, name, ordinal) - create category for categorical property\n- value_type enum: categorical, text, integer, boolean, timestamp, list\n- Built-in properties: priority, type, description, owner, labels, dependencies\n\n## Design Decisions\n- Property definitions only (not values - those are on CrumbTable)\n- Categories enable ordered enumeration for categorical properties\n- Built-in properties seeded on first startup (per prd-sqlite-backend R9)\n- Reference prd-cupboard-core R2.3\n\n## Acceptance Criteria\n- [ ] PRD saved at docs/product-requirements/prd-properties-interface.md\n- [ ] Defines Property struct\n- [ ] Defines Category struct\n- [ ] Defines PropertyTable interface matching prd-cupboard-core\n- [ ] Documents value_type enum\n- [ ] Lists built-in properties\n- [ ] Follows prd-format","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-03T21:05:19.061987-05:00","created_by":"petardjukic","updated_at":"2026-02-04T10:13:17.110519-05:00","dependencies":[{"issue_id":"crumbs-gfu.4","depends_on_id":"crumbs-gfu","type":"parent-child","created_at":"2026-02-03T21:05:19.063767-05:00","created_by":"petardjukic"}]}
{"id":"crumbs-gfu.5","title":"PRD: SQLite Backend","description":"## Type\nDocumentation\n\n## Output Path\ndocs/product-requirements/prd-sqlite-backend.md\n\n## Required Sections (per prd-format)\n1. Problem - Why we need detailed SQLite backend specification\n2. Goals - Define JSON↔SQLite sync, schema, file layout\n3. Requirements - JSON file format, SQLite schema, sync operations, startup/shutdown, error handling\n4. Non-Goals - Other backends, Cupboard interface (defined elsewhere)\n5. Acceptance Criteria - Schema documented, sync behavior specified\n\n## Scope\n- JSON file format and directory layout (DataDir structure)\n- SQLite schema matching JSON structure\n- Startup: load JSON → SQLite\n- Write operations: update SQLite → persist to JSON\n- Shutdown: flush pending writes\n- Error handling: corrupt JSON, schema mismatch\n- Concurrency: single-writer, multiple-reader\n\n## Design Decisions\n- JSON is source of truth; SQLite is ephemeral query cache\n- modernc.org/sqlite (pure Go, no CGO)\n- One JSON file per table or single JSONL file\n- Reference prd-cupboard-core R7\n\n## Acceptance Criteria\n- [ ] PRD saved at docs/product-requirements/prd-sqlite-backend.md\n- [ ] JSON file format fully specified\n- [ ] SQLite schema documented\n- [ ] Sync lifecycle (startup, write, shutdown) specified\n- [ ] Error handling documented\n- [ ] Follows prd-format","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-03T21:17:26.922101-05:00","created_by":"petardjukic","updated_at":"2026-02-04T09:59:55.836462-05:00","closed_at":"2026-02-04T09:59:55.836462-05:00","close_reason":"Closed","dependencies":[{"issue_id":"crumbs-gfu.5","depends_on_id":"crumbs-gfu","type":"parent-child","created_at":"2026-02-03T21:17:26.92315-05:00","created_by":"petardjukic"}],"comments":[{"id":2,"issue_id":"crumbs-gfu.5","author":"petardjukic","text":"tokens: 25000, loc: 477+0","created_at":"2026-02-04T14:59:55Z"}]}
{"id":"crumbs-gfu.6","title":"PRD: Metadata Interface","description":"## Type\nDocumentation\n\n## Output Path\ndocs/product-requirements/prd-metadata-interface.md\n\n## Required Sections (per prd-format)\n1. Problem - Extensible metadata storage (comments, attachments, logs)\n2. Goals - Define MetadataTable interface\n3. Requirements - Metadata struct, Schema struct, Register, Add, Get, Search\n4. Non-Goals - Core crumb/trail operations (separate interfaces)\n5. Acceptance Criteria - Interface defined, built-in tables listed\n\n## Scope (from prd-cupboard-core table accessor pattern)\n- Metadata struct: metadata_id, table_name, crumb_id, property_id, content, created_at\n- Schema struct: defines fields for custom metadata tables\n- MetadataTable interface from prd-cupboard-core:\n  - Register(tableName, schema) - add new metadata table type\n  - Add(tableName, crumbID, content, propertyID?) - add metadata entry\n  - Get(tableName, crumbID) - retrieve metadata for crumb\n  - Search(tableName, filter) - search by crumb, property, or text\n- MetadataFilter struct for search\n- Built-in tables: comments, attachments\n\n## Design Decisions\n- Metadata tables are extensible at runtime\n- Schema defines structure but storage is flexible (content as text/JSON)\n- Search supports filtering by crumb_id, property_id, or text content\n- Reference prd-cupboard-core R2.3, prd-sqlite-backend R2.9\n\n## Acceptance Criteria\n- [ ] PRD saved at docs/product-requirements/prd-metadata-interface.md\n- [ ] Defines Metadata struct\n- [ ] Defines Schema struct\n- [ ] Defines MetadataTable interface matching prd-cupboard-core\n- [ ] Defines MetadataFilter for search\n- [ ] Lists built-in tables (comments, attachments)\n- [ ] Follows prd-format","status":"open","priority":2,"issue_type":"task","created_at":"2026-02-04T10:13:31.44233-05:00","created_by":"petardjukic","updated_at":"2026-02-04T10:13:31.44233-05:00","dependencies":[{"issue_id":"crumbs-gfu.6","depends_on_id":"crumbs-gfu","type":"parent-child","created_at":"2026-02-04T10:13:31.443413-05:00","created_by":"petardjukic"}]}
