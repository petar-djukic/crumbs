{"id":"generation-2026-02-11-21-45-35-pjk","title":"Define pkg/types: Config, Cupboard, Table interfaces, entity structs, and error sentinels","description":"## Required Reading\n- docs/specs/product-requirements/prd001-cupboard-core.yaml (Config, Cupboard, Table interfaces, error types, UUID v7)\n- docs/specs/product-requirements/prd003-crumbs-interface.yaml (Crumb struct R1, state values R2, state transition methods R4)\n- docs/specs/product-requirements/prd006-trails-interface.yaml (Trail struct)\n- docs/specs/product-requirements/prd007-links-interface.yaml (Link struct)\n- docs/specs/product-requirements/prd004-properties-interface.yaml (Property and Category structs)\n- docs/specs/product-requirements/prd005-metadata-interface.yaml (Metadata struct)\n- docs/specs/product-requirements/prd008-stash-interface.yaml (Stash struct)\n- docs/ARCHITECTURE.md ยง Main Interfaces, ยง Design Decisions\n\n## Files to Create/Modify\n- pkg/types/config.go (create) - Config struct with Backend and DataDir fields, config validation errors (ErrBackendEmpty, ErrBackendUnknown, ErrSyncStrategyUnknown, ErrBatchSizeInvalid, ErrBatchIntervalInvalid), Validate method\n- pkg/types/cupboard.go (create) - Cupboard interface (GetTable, Attach, Detach), cupboard lifecycle errors (ErrCupboardDetached, ErrAlreadyAttached, ErrTableNotFound), standard table name constants\n- pkg/types/table.go (create) - Table interface (Get, Set, Delete, Fetch), table operation errors (ErrNotFound, ErrInvalidID, ErrInvalidData), entity method errors (ErrInvalidState, ErrInvalidTransition, ErrInvalidName, ErrPropertyNotFound, ErrTypeMismatch, ErrInvalidCategory, ErrInvalidStashType, ErrLockHeld, ErrNotLockHolder, ErrInvalidHolder, ErrAlreadyInTrail, ErrNotInTrail, ErrSchemaNotFound, ErrInvalidContent, ErrInvalidFilter)\n- pkg/types/crumb.go (create) - Crumb struct (CrumbID, Name, State, CreatedAt, UpdatedAt, Properties), state constants (draft, pending, ready, taken, pebble, dust), entity methods (SetState, Pebble, Dust)\n- pkg/types/trail.go (create) - Trail struct (TrailID, State, CreatedAt, CompletedAt), trail state constants, entity methods (Complete, Abandon)\n- pkg/types/link.go (create) - Link struct (LinkID, FromID, ToID, LinkType, CreatedAt), link type constants (belongs_to, child_of, branches_from, scoped_to)\n- pkg/types/property.go (create) - Property struct (PropertyID, Name, Description, ValueType, CreatedAt), Category struct (CategoryID, PropertyID, Name, Ordinal), value type constants\n- pkg/types/metadata.go (create) - Metadata struct (MetadataID, EntityID, SchemaType, Content, CreatedAt)\n- pkg/types/stash.go (create) - Stash struct (StashID, Name, StashType, Value, Version, HolderID, CreatedAt, UpdatedAt), stash type constants, StashHistory struct\n\n## Requirements\n- Define all types as pure data structs in pkg/types with JSON tags matching the JSONL field names from prd002 (snake_case)\n- Define the Cupboard interface per prd001 R2.2: GetTable(name string) (Table, error), Attach(config Config) error, Detach() error\n- Define the Table interface per prd001 R3.1: Get(id string) (any, error), Set(id string, data any) (string, error), Delete(id string) error, Fetch(filter map[string]any) ([]any, error)\n- Define Config struct per prd001 R1.1 with Backend and DataDir fields, plus a Validate() method per R1.2-R1.4\n- Define all sentinel errors from prd001 R7.1-R7.3 using errors.New\n- Define Crumb entity methods (SetState, Pebble, Dust) per prd003 R4.1-R4.4 with state validation\n- Define standard table name constants per prd001 R2.5\n- All entity IDs are UUID v7 strings (generated by backend, not by types package)\n\n## Design Decisions\n- pkg/types is the contract layer: interfaces and structs only, no implementation logic beyond entity methods and config validation\n- JSON tags use snake_case to match JSONL format (e.g., `json:\"crumb_id\"`)\n- Entity methods modify the struct in memory; callers persist via Table.Set (ORM pattern per ARCHITECTURE)\n- State constants are string constants, not iota enums, for JSON compatibility\n- Properties field on Crumb is map[string]any (property_id to value)\n- Trail membership is NOT a Crumb field; it lives in the links table\n\n## Acceptance Criteria\n- [ ] All files compile: `go build ./pkg/types/...` succeeds\n- [ ] Config.Validate() returns ErrBackendEmpty for empty Backend\n- [ ] Config.Validate() returns ErrBackendUnknown for unrecognized Backend\n- [ ] Crumb.SetState(\"ready\") succeeds and updates State and UpdatedAt\n- [ ] Crumb.SetState(\"invalid\") returns ErrInvalidState\n- [ ] Crumb.Pebble() from state \"taken\" succeeds\n- [ ] Crumb.Pebble() from state \"draft\" returns ErrInvalidTransition\n- [ ] Crumb.Dust() succeeds from any state\n- [ ] All sentinel errors defined and usable with errors.Is\n- [ ] Standard table name constants match prd001 R2.5 (crumbs, trails, properties, metadata, links, stashes)\n- [ ] Unit tests for Config.Validate, Crumb.SetState, Crumb.Pebble, Crumb.Dust in pkg/types/*_test.go\n- [ ] Trail.Complete and Trail.Abandon entity methods with state validation","status":"closed","priority":2,"issue_type":"task","owner":"petar.djukic@gmail.com","created_at":"2026-02-11T21:48:22.046705-05:00","created_by":"petardjukic","updated_at":"2026-02-11T21:52:12.777309-05:00","closed_at":"2026-02-11T21:52:12.777309-05:00","close_reason":"Closed"}
